import{l as r,j as e,s as we,a as Ee,g as be,b as Le,A as j,r as f,e as x,C as A,c as pe,d as Oe,R as F,f as H,h as ze,i as _e,P as Be,k as xe,m as Fe,u as fe,n as le,o as he,p as Pe,q as Ge,t as qe,v as We,w as Ue,x as He,y as Ye,z as Je,B as Ve,D as Ze,E as $e,F as Y,G as Ke,H as Qe,I as Xe,J as X,K as et}from"./main-1.0.4.js";import{A as W,a as tt}from"./AdminTheme-1.0.4-e85d4fc0.js";import{B as l,u as O,M as J,a as st,b as I,T as L,c as rt,A as je,d as Ae,e as Te,f as $,g as at,h as it,i as nt,j as ot,S as pt,D as E,k as lt,l as dt,m as ct,v as ut,n as xt,o as ht,p as mt,q as gt}from"./main-1.0.4-3f927327.js";import{T as ee,C as de,s as bt,S as ye,R as ft,a as te,B as jt,b as At,c as Tt,d as yt,e as se}from"./TabPanel-1.0.4-14af6bd6.js";import{C as Ce,a as ve,b as Se}from"./ComponentDatabase-1.0.4-efe98b3e.js";import{A as k,a as M,b as V}from"./AccordionSummary-1.0.4-dffa253b.js";import{T as q,F as K,I as Ct,S as vt,a as Q,b as ae,A as ie}from"./TextField-1.0.4-6b1bbbfd.js";import{M as St}from"./MenuItem-1.0.4-50d14a51.js";import{B as P,C as ne,a as oe}from"./CardContent-1.0.4-55ef4296.js";import{a as Dt,b as Rt,c as It,d as kt,e as Mt,f as Nt}from"./ActionsApp-1.0.4-2e836240.js";import{R as wt}from"./RadioGroup-1.0.4-078a1a14.js";import{R as me}from"./Radio-1.0.4-bd38ebb7.js";import{F as De}from"./FormControlLabel-1.0.4-64c2f78b.js";import{l as Et,C as Lt}from"./index-1.0.4-e7535e92.js";import{I as G,T as ge,P as Ot}from"./iconBase-1.0.4-684ba590.js";import{T as re}from"./Tabs-1.0.4-276a4db7.js";import{B as U}from"./index.esm-1.0.4-53f8e071.js";import{L as Z}from"./Link-1.0.4-4f39d399.js";import{c as zt}from"./index-1.0.4-6dbd728b.js";import{S as _t,a as Bt,b as Ft}from"./Stepper-1.0.4-274e952c.js";import{A as Pt}from"./AppMetaData-1.0.4-aca3e41e.js";import{I as Gt}from"./InputAdornment-1.0.4-7c5d0d8f.js";import{C as qt}from"./Checkbox-1.0.4-04061c16.js";import"./Close-1.0.4-ca2bff70.js";import"./DialogContent-1.0.4-604ea0cd.js";import"./ActionsExplorer-1.0.4-d9d7ac7b.js";import"./useSlot-1.0.4-77de692c.js";import"./Alert-1.0.4-09b90733.js";import"./AlertTitle-1.0.4-103cc369.js";const Wt=({app:s})=>(r.debug(s),e.jsxs(l,{children:[e.jsx(k,{disableGutters:!0,children:e.jsx(M,{children:e.jsx(Ce,{})})}),e.jsx(k,{disableGutters:!0,children:e.jsx(M,{children:e.jsx(ve,{})})}),e.jsx(k,{disableGutters:!0,children:e.jsx(M,{children:e.jsx(Se,{app:s})})})]})),Re=({app:s,hasErrors:o})=>{r.debug(s,o);const a=O();return e.jsx(q,{type:"text",label:"App Name",error:o,fullWidth:!0,required:!0,helperText:"App name must be unique",value:s.appName,autoFocus:!0,autoComplete:"off",onChange:n=>{a(we({appName:n.target.value}))}})},Ie=({app:s,hasErrors:o})=>{r.debug(s,o);const a=O();return e.jsx(q,{type:"text",label:"App Title",error:o,fullWidth:!0,required:!0,helperText:"App title describes the purpose of the app",value:s.appTitle,autoComplete:"off",onChange:n=>{a(Ee({appTitle:n.target.value}))}})},ke=({app:s})=>{r.debug(s);const o=O(),a=be();return r.debug(a),e.jsxs(K,{children:[e.jsx(Ct,{variant:"outlined",children:"App Type *"}),e.jsxs(vt,{label:"App Type *",value:s.appType,onChange:n=>{o(Le({appType:n.target.value}))},children:[...a.map(n=>{const m=n.id===j.DATATABLE||n.id===j.DATAENTRY;return e.jsx(St,{value:n.id,disabled:!m,children:n.text})})]}),e.jsx(Q,{children:"Select app type from drop-down list (currently supporting Data Tables and Data Administration only, more types will be added later)"})]})},Ut=({app:s})=>{r.debug(s);const[o,a]=f.useState(!1),[n,m]=f.useState(void 0),g=()=>{switch(n){case"form":return"Reset Form Builder?";case"theme":return"Reset Theme?";default:return"Reset Table Builder?"}};return e.jsxs(e.Fragment,{children:[e.jsxs(k,{disableGutters:!0,children:[e.jsx(M,{expandIcon:e.jsx(J,{}),children:"Reset"}),e.jsx(V,{children:e.jsxs(K,{sx:{display:"grid",gridGap:"20px"},children:[e.jsx(P,{variant:"contained",color:"primary",onClick:()=>{m(ee.TABLE),a(!0)},children:"Reset Table Builder"}),e.jsx(P,{variant:"contained",color:"primary",onClick:()=>{m(ee.FORM),a(!0)},children:"Reset Form Builder"}),e.jsx(P,{variant:"contained",color:"primary",onClick:()=>{m(ee.THEME),a(!0)},children:"Reset Theme"}),e.jsxs(Q,{sx:{display:"inline-grid",gridTemplateColumns:"20px auto",gridGap:"5px",alignItems:"center","& svg":{fontSize:"20px"}},children:[e.jsx(st,{}),"A reset cannot be undone!"]})]})})]}),e.jsx(de,{title:g(),message:"Are you sure? This action cannot be undone!",open:o,setOpen:a,onConfirm:()=>{n!==void 0&&bt(s.appDbId,s.appCntId,n,null,null,u=>{if(u!=null&&u.code&&(u==null?void 0:u.message)!==void 0)switch(u.code){case"ok":x(u.message,{variant:"success"});break;case"info":x(u.message,{variant:"info"});break;default:x(u.message??A.contactSupport,{variant:"error"})}else r.error(u),x(A.contactSupport,{variant:"error"})},u=>{r.error("error",u),x(u??A.contactSupport,{variant:"error"})})}})]})},Ht=({app:s})=>(r.debug(s),e.jsxs(l,{children:[e.jsx(k,{disableGutters:!0,children:e.jsx(M,{children:e.jsx(Re,{app:s,hasErrors:!1})})}),e.jsx(k,{disableGutters:!0,children:e.jsx(M,{children:e.jsx(Ie,{app:s,hasErrors:!1})})}),e.jsx(k,{disableGutters:!0,children:e.jsx(M,{children:e.jsx(ke,{app:s})})}),e.jsx(Ut,{app:s})]})),Me=()=>{const s=O(),o=I(t=>pe(t));r.debug("app",o);const a=I(t=>Oe(t));r.debug("appMetaData",a);const n=f.useMemo(()=>{const t=[];if((a==null?void 0:a.roles)!==void 0)for(const h in a.roles)t.push({key:h,value:a.roles[h]});return t},[a.roles]);r.debug(n);const m=f.useMemo(()=>{const t=[];if((a==null?void 0:a.users)!==void 0)for(const h in a.users)t.push({key:h,value:a.users[h]});return t},[a.users]);r.debug(m);const g=f.useMemo(()=>n.filter(t=>o.appRestApi.authorized_roles.includes(t.key)),[o.appRestApi.authorized_roles,n]),u=f.useMemo(()=>m.filter(t=>o.appRestApi.authorized_users.includes(t.key)),[o.appRestApi.authorized_users,m]);return e.jsxs(K,{sx:{width:"100%"},children:[e.jsxs(wt,{children:[e.jsxs(ae,{className:"align-label-radio",sx:{cursor:"pointer"},children:[e.jsx(me,{checked:o.appRestApi.authorization===F.AUTHORIZED,onChange:t=>{s(H({restApiActions:{...o.appRestApi,authorization:F.AUTHORIZED}})),t.stopPropagation()}}),"Authorized access only"]}),e.jsxs(l,{sx:{display:"grid",gridGap:"10px",margin:"30px 20px 25px 42px"},children:[e.jsx(ie,{multiple:!0,options:n,getOptionLabel:t=>t.value,value:g,onChange:(t,h)=>{s(H({restApiActions:{...o.appRestApi,authorized_roles:h.map(y=>y.key)}})),t.stopPropagation()},renderInput:t=>e.jsx(q,{...t,label:"Roles"})}),e.jsx(ie,{multiple:!0,options:m,getOptionLabel:t=>t.value,value:u,onChange:(t,h)=>{s(H({restApiActions:{...o.appRestApi,authorized_users:h.map(y=>y.key)}})),t.stopPropagation()},renderInput:t=>e.jsx(q,{...t,label:"Users"})})]}),e.jsxs(ae,{className:"align-label-radio",sx:{cursor:"pointer"},children:[e.jsx(me,{checked:o.appRestApi.authorization===F.ANONYMOUS,onChange:t=>{s(H({restApiActions:{...o.appRestApi,authorization:F.ANONYMOUS}})),t.stopPropagation()}}),"Anonymous access"]})]}),o.appRestApi.authorization===F.ANONYMOUS&&e.jsx(l,{sx:{marginTop:"10px",marginLeft:"10px"},children:e.jsx(Q,{children:"This setting allows non-authorized users to access this app"})})]})},Yt=({app:s})=>{r.debug(s);const o=O();return e.jsxs(l,{sx:{display:"grid",gridGap:"30px"},children:[e.jsx(De,{control:e.jsx(ye,{checked:s.appAddToMenu,onChange:(a,n)=>{o(ze({appAddToMenu:n})),a.stopPropagation()}}),label:"Add App to WordPress dashboard menu",labelPlacement:"end"}),s.appAddToMenu&&e.jsx(q,{type:"text",label:"Title",fullWidth:!0,required:!0,helperText:"Title shown in WordPress dashboard menu",value:s.appMenuTitle,autoComplete:"off",onChange:a=>{o(_e({appMenuTitle:a.target.value})),a.stopPropagation()}})]})},Jt=({app:s})=>{r.debug(s);const o=()=>`[wpda_app app_id="${s.appDbId}"${a?' feedback="true"':""}]`,[a,n]=f.useState(!1),[m,g]=f.useState(o());return f.useEffect(()=>{g(o())},[a]),e.jsxs(l,{sx:{display:"grid",gridGap:"20px"},children:[e.jsxs(l,{children:[e.jsx(ae,{children:"App short code"}),e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center","& pre":{backgroundColor:"#ccc",padding:"4px"}},children:[e.jsx("pre",{children:m}),e.jsx(Et.CopyToClipboard,{text:m,onCopy:()=>{x("Shortcode was copied to your clipboard",{variant:"info"})},children:e.jsx(L,{title:"Copy shortcode to clipboard",children:e.jsx(G,{children:e.jsx(rt,{})})})})]})]}),e.jsx(l,{children:e.jsxs(K,{children:[e.jsx(De,{control:e.jsx(ye,{checked:a,onChange:(u,t)=>{n(t),u.stopPropagation()}}),label:"Feedback",labelPlacement:"end"}),e.jsx(Q,{children:"Show authorization and usage errors"})]})})]})},Vt=({app:s})=>(r.debug(s),e.jsxs(l,{children:[e.jsxs(k,{disableGutters:!0,children:[e.jsx(M,{expandIcon:e.jsx(J,{}),children:"Authorize Roles & Users"}),e.jsx(V,{children:e.jsx(Me,{})})]}),e.jsxs(k,{disableGutters:!0,children:[e.jsx(M,{expandIcon:e.jsx(J,{}),children:"Back-end Access"}),e.jsx(V,{children:e.jsx(Yt,{app:s})})]}),e.jsxs(k,{disableGutters:!0,children:[e.jsx(M,{expandIcon:e.jsx(J,{}),children:"Front-end Access"}),e.jsx(V,{children:e.jsx(Jt,{app:s})})]})]})),Zt=({appDbId:s})=>{var N,d;r.debug(s);const o=O(),a=((N=W)==null?void 0:N.palette.mode)===Be.LIGHT?(d=W)==null?void 0:d.palette.primary.main:"",[n,m]=f.useState(!1);r.debug(n);const g=I(i=>pe(i));r.debug("app",g);const u=()=>{o(fe({}))},t=()=>{u()},h=()=>g.appName?g.appTitle?g.appDatabase?g.appTable?g.appColumns.filter(i=>i.isSelected).length===0?(x("At least one column must be selected",{variant:"error"}),!1):!0:(x("Table is required",{variant:"error"}),!1):(x("Database is required",{variant:"error"}),!1):(x("App title is required",{variant:"error"}),!1):(x("App name is required",{variant:"error"}),!1),y=()=>{h()&&(r.debug(g),Dt(g,i=>{if(r.debug(i),i!=null&&i.code&&(i==null?void 0:i.message)!==void 0)switch(i.code){case"ok":x(i.message,{variant:"success"}),o(le({}));break;case"info":x(i.message,{variant:"info"});break;default:r.error(i),x(i.message??A.contactSupport,{variant:"error"})}else r.error(i),x(A.contactSupport,{variant:"error"})},i=>{r.error("error",i),x(i??A.contactSupport,{variant:"error"})}))},z=()=>{y(),u()},D=i=>{o(Fe({anchor:i}))},[p,S]=f.useState("1"),C=(i,w)=>{S(w)};return e.jsxs(ft,{closeDrawer:t,children:[e.jsx(je,{position:"static",sx:{borderRadius:0},children:e.jsxs(Ae,{className:"pp-setting-toolbar",sx:{borderRadius:0},children:[e.jsxs(l,{sx:{flexGrow:1},children:[e.jsx(ge,{variant:"h5",noWrap:!0,component:"div",className:"unselectable",sx:{display:{xs:"none",sm:"block"},paddingLeft:"6px"},children:"Manage App"}),e.jsx(ge,{sx:{fontSize:"10px",display:{xs:"none",sm:"block"},paddingLeft:"10px"},children:g.appName})]}),e.jsx(te,{title:"Dock to left",position:"bottom",children:e.jsx(G,{onClick:()=>{D(xe.LEFT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(jt,{})})}),e.jsx(te,{title:"Dock to right",position:"bottom",children:e.jsx(G,{onClick:()=>{D(xe.RIGHT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(At,{})})}),e.jsx(te,{title:"Close",position:"bottom",children:e.jsx(G,{onClick:t,size:"large",color:"inherit",sx:{fontSize:"1.4em"},children:e.jsx(Te,{})})})]})}),e.jsx(ne,{className:"pp-settings-container",children:e.jsx(oe,{sx:{padding:0,margin:0},children:e.jsxs(Tt,{value:p,children:[e.jsxs(yt,{variant:"fullWidth",textColor:"primary",onChange:C,sx:{width:"100%",height:"80px",padding:0,margin:0,backgroundColor:"rgb(242, 242, 242)"},children:[e.jsx(re,{label:"App Info",value:"1",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}}),e.jsx(re,{label:"Data Source",value:"2",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}}),e.jsx(re,{label:"Access",value:"3",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}})]}),e.jsxs(l,{sx:{margin:0,padding:0,overflowY:"auto",height:"calc(100vh - 250px)","& > div.MuiTabPanel-root":{padding:0}},children:[e.jsx(se,{value:"1",children:e.jsx(Ht,{app:g,setIsUpdated:m})}),e.jsx(se,{value:"2",children:e.jsx(Wt,{app:g,setIsUpdated:m})}),e.jsx(se,{value:"3",children:e.jsx(Vt,{app:g,setIsUpdated:m})})]})]})})}),e.jsx(ne,{className:"pp-setting-footer",sx:{borderRadius:0,backgroundColor:a},children:e.jsxs(oe,{className:"pp-setting-footer-buttons",sx:{borderRadius:0},children:[e.jsx(P,{variant:"outlined",className:"footer_action_button_apply",onClick:y,children:"Apply"}),e.jsx(P,{variant:"outlined",className:"footer_action_button",onClick:z,children:"OK"}),e.jsx(P,{variant:"outlined",className:"footer_action_button",onClick:t,children:"Cancel"})]})})]})},$t=({app:s})=>{var y,z,D;r.debug(s);const o=O(),[a,n]=f.useState(!1),m=p=>{Rt(p,S=>{var N;const C=S==null?void 0:S.data;if(r.debug("response data",C),C.app&&C.app.app&&Array.isArray(C.app.app)&&C.app.container&&Array.isArray(C.app.container)){const d=C.app.app[0],i=C.app.container[0];r.debug(d,i);let w=[];try{w=JSON.parse(i.cnt_cls)}catch(v){r.error("Invalid JSON - app columns"),r.error(v),x("Invalid JSON, check console",{variant:"error"})}let T={};try{T=JSON.parse(d.app_settings)}catch(v){T.rest_api={authorization:F.AUTHORIZED,authorized_roles:[],authorized_users:[]},r.error("Invalid JSON - app settings"),r.error(v),x("Invalid JSON, check console",{variant:"error"})}o(Ge({appDbId:p,appId:ot(p),appName:d.app_name,appTitle:d.app_title,appType:d.app_type,appCntId:i.cnt_id,appCntSeqNr:i.cnt_seq_nr,appDatabase:i.cnt_dbs,appTable:i.cnt_tbl,appColumns:w,appRestApi:T==null?void 0:T.rest_api,appAddToMenu:d.app_add_to_menu!=="0",appMenuTitle:((N=T==null?void 0:T.settings)==null?void 0:N.app_menu_title)??d.app_title,appMetaData:C}))}else x(A.contactSupport,{variant:"error"})},S=>{r.error("error",S),x(S??A.contactSupport,{variant:"error"})})},g=()=>{switch(s.appType){case j.DATAENTRY:return e.jsx(U,{});case j.MASTERDETAIL:return e.jsx(U,{});case j.REGISTRATION:return e.jsx(U,{});case j.UPDATEFORM:return e.jsx(U,{});default:return e.jsx(U,{})}},u=()=>{It(s.appId,p=>{if(r.debug(p),p!=null&&p.code&&(p==null?void 0:p.message)!==void 0)switch(p.code){case"ok":x(p.message,{variant:"success"}),o(le({}));break;case"info":x(p.message,{variant:"info"});break;default:r.error(p),x(p.message??A.contactSupport,{variant:"error"})}else r.error(p),x(A.contactSupport,{variant:"error"});n(!1)},p=>{r.error("error",p),x(p??A.contactSupport,{variant:"error"}),n(!1)})},t=$("(max-width:700px)"),h=$("(max-width:900px)");return e.jsxs(e.Fragment,{children:[e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center",padding:"24px",...h&&{".pp-row-actions":{width:0}},"&:hover":{".pp-row-title":{display:h?"inline-block":"none"},".pp-row-actions":{visibility:h?"hidden":"visible"}}},children:[e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"auto auto",alignItems:"center"},children:[e.jsxs(l,{sx:{width:"100%",display:"grid",gridTemplateColumns:"auto 1fr",gridGap:"10px",justifyContent:"center",alignItems:"center"},children:[e.jsx(l,{children:g()}),e.jsxs(l,{sx:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},children:[s.appName,e.jsxs(l,{className:"pp-row-title",sx:{display:"inline-block",marginLeft:"5px",fontSize:"80%"},children:["−",e.jsx(l,{sx:{display:"inline-block",width:"5px"}}),s.appTitle]})]})]}),e.jsxs(l,{sx:{display:"grid",visibility:"hidden",gridTemplateColumns:"auto auto auto auto auto auto",gridGap:"10px",marginLeft:"10px",alignItems:"center"},className:"pp-row-actions",children:[e.jsx(l,{sx:{borderLeft:"1px solid black",height:"100%"}}),e.jsx(L,{title:"Manage App",children:e.jsx(Z,{sx:{cursor:"pointer"},underline:"none",onClick:p=>{m(s.appId),p.preventDefault(),p.stopPropagation()},children:"Manage"})}),e.jsx(l,{sx:{borderLeft:"1px solid black",height:"100%"}}),e.jsx(L,{title:"Run & Build App",children:e.jsx(Z,{sx:{cursor:"pointer"},underline:"none",onClick:p=>{o(he({isActive:!0,appDbId:s.appId})),p.preventDefault(),p.stopPropagation()},children:"Run & Build"})}),e.jsx(l,{sx:{borderLeft:"1px solid black",height:"100%"}}),e.jsx(L,{title:"Delete App",children:e.jsx(Z,{sx:{cursor:"pointer"},underline:"none",onClick:p=>{n(!0),p.preventDefault(),p.stopPropagation()},children:"Delete"})})]})]}),e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"auto auto auto auto",justifyContent:t?"end":"space-evenly",alignItems:"center"},children:[e.jsx(l,{sx:{paddingRight:"10px"},children:t?"":Pe(s.appType)}),e.jsx(L,{title:"Manage App",children:e.jsx(G,{sx:{color:(y=W)==null?void 0:y.palette.primary.main},onClick:p=>{m(s.appId),p.preventDefault(),p.stopPropagation()},children:e.jsx(at,{})})}),e.jsx(L,{title:"Run & Build App",children:e.jsx(G,{sx:{color:(z=W)==null?void 0:z.palette.primary.main},onClick:p=>{o(he({isActive:!0,appDbId:s.appId})),p.preventDefault(),p.stopPropagation()},children:e.jsx(it,{})})}),e.jsx(L,{title:"Delete App",children:e.jsx(G,{sx:{color:(D=W)==null?void 0:D.palette.error.main},onClick:p=>{n(!0),p.preventDefault(),p.stopPropagation()},children:e.jsx(nt,{})})})]})]}),a&&e.jsx(de,{title:"Delete App?",message:"Are you sure you want to delete this app? This action cannot be undone!",open:a,setOpen:n,onConfirm:()=>u()})]})},Kt=({apps:s,search:o,types:a,isLoading:n})=>{r.debug(s,o,a);const m=u=>!(o!==""&&!u.appName.toLowerCase().includes(o.toLowerCase())&&!u.appTitle.toLowerCase().includes(o.toLowerCase())||a.length>0&&a.filter(t=>t.id===Number(u.appType)).length===0),g=s.filter(u=>m(u)?u:null);return e.jsxs(l,{sx:{backgroundColor:"#fff",borderBottom:"1px solid rgba(0, 0, 0, 0.34)",borderRadius:"4px","& .MuiBox-root:first-of-type":{borderTopLeftRadius:"4px",borderTopRightRadius:"4px"},"& .MuiBox-root:hover":{backgroundColor:"rgb(242, 242, 242)"}},children:[...s.map(u=>{const t=m(u);return e.jsx(l,{className:"pp-app-details",sx:{borderTop:"1px solid rgba(0, 0, 0, 0.34)",visibility:t?"visible":"hidden",position:t?"relative":"fixed"},children:e.jsx($t,{app:u})})}),g.length===0&&e.jsx(l,{sx:{padding:"35px",borderTop:"1px solid rgba(0, 0, 0, 0.34)",borderRadius:"4px"},children:n?e.jsx(pt,{title:"Loading apps...",align:qe.LEFT}):e.jsx(l,{children:"No apps found"})})]})},Qt=({setMode:s})=>{const o=O(),a=["App info","Data source","Authorization"],[n,m]=f.useState(0),[g,u]=f.useState(!1),t=I(d=>pe(d));r.debug("app",t),f.useEffect(()=>{let d=null;switch(t.appType){case j.DATATABLE:d=F.ANONYMOUS;break;case j.DATAENTRY:case j.MASTERDETAIL:case j.REGISTRATION:case j.UPDATEFORM:case j.APPCONTAINER:d=F.AUTHORIZED;break}d!==null?o(H({restApiActions:We(d)})):x(A.contactSupport,{variant:"error"})},[t.appType]);const[h,y]=f.useState({appName:!1,appTitle:!1,appDatabase:!1,appTable:!1,appColumns:!1});r.debug(h);const z=()=>{const d=zt(Ue);d.table.transactions.insert=Number(t.appType)===j.DATAENTRY||Number(t.appType)===j.MASTERDETAIL||Number(t.appType)===j.REGISTRATION,d.table.transactions.update=Number(t.appType)===j.DATAENTRY||Number(t.appType)===j.MASTERDETAIL||Number(t.appType)===j.UPDATEFORM,d.table.transactions.delete=Number(t.appType)===j.DATAENTRY||Number(t.appType)===j.MASTERDETAIL,kt(t,d,i=>{if(r.debug(i),i!=null&&i.code&&(i==null?void 0:i.message)!==void 0)switch(i.code){case"ok":x(i.message,{variant:"success"}),s(E.TABLE),o(le({}));break;case"info":x(i.message,{variant:"info"});break;default:r.error(i),x(i.message??A.contactSupport,{variant:"error"})}else r.error(i),x(A.contactSupport,{variant:"error"})},i=>{r.error("error",i),x(i??A.contactSupport,{variant:"error"})})},D=()=>{var i,w;let d=!0;if(n===0){let T=!1,v=!1;t.appName.trim()===""&&(x("App name is required",{variant:"error"}),T=!0,d=!1),t.appTitle.trim()===""&&(x("App title is required",{variant:"error"}),v=!0,d=!1),y({...h,appName:T,appTitle:v})}if(n===1){let T=!1,v=!1,_=!1;((i=t.appDatabase)==null?void 0:i.trim())===""&&(x("Database is required",{variant:"error"}),T=!0,d=!1),((w=t.appTable)==null?void 0:w.trim())===""&&(x("Table is required",{variant:"error"}),v=!0,d=!1),t.appColumns.length===0&&(x("No columns selected",{variant:"error"}),_=!0,d=!1),y({...h,appDatabase:T,appTable:v,appColumns:_})}return n===2&&z(),r.debug(d),d},p=()=>e.jsxs(l,{sx:{textAlign:"right",display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[n>0?e.jsx(P,{variant:"outlined",size:"medium",sx:{width:"160px",marginRight:"10px"},onClick:()=>{m(n-1)},startIcon:e.jsx(lt,{}),children:e.jsx(l,{children:"Back"})}):e.jsx(l,{}),e.jsx(P,{variant:"contained",size:"medium",sx:{width:"160px"},onClick:()=>{D()&&n<2&&m(n+1)},startIcon:n>=2&&e.jsx(dt,{}),endIcon:n<2&&e.jsx(ct,{}),children:e.jsx(l,{children:n<2?"Next":"Finish"})})]}),S=()=>e.jsxs(e.Fragment,{children:[e.jsx(Re,{app:t,hasErrors:h.appName}),e.jsx(Ie,{app:t,hasErrors:h.appName}),e.jsx(ke,{app:t}),p()]}),C=()=>e.jsxs(e.Fragment,{children:[e.jsx(Ce,{}),e.jsx(l,{sx:{display:t.appDatabase?"block":"none"},children:e.jsx(ve,{})}),e.jsx(l,{sx:{display:t.appTable?"block":"none"},children:e.jsx(Se,{app:t})}),p()]}),N=()=>e.jsxs(e.Fragment,{children:[e.jsx(l,{children:e.jsx(Me,{})}),p()]});return e.jsxs(e.Fragment,{children:[e.jsxs(ne,{variant:"outlined",sx:{padding:"50px 70px 40px 70px",display:"grid",gridGap:"40px"},children:[e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"start"},children:[e.jsx(Lt,{title:"App Wizard",subheader:"Add new app",sx:{padding:0}}),e.jsx(l,{children:e.jsx(L,{title:"Close",children:e.jsx(Z,{sx:{cursor:"pointer"},underline:"none",onClick:d=>{u(!0),d.preventDefault(),d.stopPropagation()},children:e.jsx(l,{sx:{fontSize:"1.5rem",color:"#000"},children:e.jsx(Te,{})})})})})]}),e.jsxs(oe,{sx:{padding:0,display:"grid",gridGap:"30px"},children:[e.jsx(_t,{activeStep:n,sx:{margin:"10px 0 30px 0"},children:a.map((d,i)=>(r.debug(d,i),e.jsx(Bt,{children:e.jsx(Ft,{children:d})},d)))}),e.jsxs("form",{onSubmit:d=>(d.preventDefault(),D()&&m(n+1),!1),style:{display:"grid",gridGap:"40px"},children:[n===0&&S(),n===1&&C(),n===2&&N(),e.jsx("input",{type:"submit",style:{display:"none"}})]})]})]}),e.jsx(de,{title:"Close App Wizard?",message:"All uncommitted changes will be lost!",open:g,setOpen:u,onConfirm:()=>{s(E.TABLE)}})]})};const Is=()=>{var ue;const s=O(),o=f.useMemo(()=>ut(),[]),[a,n]=f.useState(E.TABLE);r.debug(a);const m=I(c=>He(c));r.debug("apps",m);const g=I(c=>Ye(c));r.debug("appDbId",g);const u=I(c=>Je(c));r.debug("dbSearch",u);const t=I(c=>Ve(c));r.debug("dbTypes",t);const h=I(c=>Ze(c));r.debug("designMode",h);const y=I(c=>$e(c));r.debug("reload",y);const[z,D]=f.useState(!0);f.useEffect(()=>{S(),p()},[y]);const p=()=>{Mt(function(c){const b=c==null?void 0:c.data;if(r.debug("response data",b),Array.isArray(b)){const R=[];for(let B=0;B<b.length;B++)R.push({appId:b[B].app_id,appName:b[B].app_name,appTitle:b[B].app_title,appType:b[B].app_type,appSettings:b[B].app_settings,appAddToMenu:b[B].app_add_to_menu});s(X({appList:R}))}else r.error(b),x((b==null?void 0:b.message)??A.contactSupport,{variant:"error"}),s(X({appList:[]}));D(!1)},c=>{r.error("error",c),x(c??A.contactSupport,{variant:"error"}),s(X({appList:[]})),D(!1)})},S=()=>{Nt(function(c){const b=c==null?void 0:c.data;r.debug("response data",b),s(et({appMetaData:b}))},c=>{r.error("error",c),x(c??A.contactSupport,{variant:"error"})})};f.useEffect(()=>{Y.appPlugin&&(a===1||h.isActive===!0&&h.appDbId>0?window.document.documentElement.style.setProperty("--addAppIconVisibility","hidden"):window.document.documentElement.style.setProperty("--addAppIconVisibility","visible"),window.ppAddApp=function(){a===0&&!(h.isActive===!0&&h.appDbId>0)&&n(E.FORM)})},[a,h]);const[C,N]=f.useState(250),d=$("(max-width: 600px)"),i=$("(max-width: 900px)");f.useEffect(()=>{v.current&&N(v.current.offsetWidth)},[t]);const w=tt(),T=be();r.debug(T);const v=f.useRef(),_=()=>h.isActive===!0&&h.appDbId>0,Ne=()=>{var c,b,R;return e.jsx(L,{title:"Add new app",children:e.jsx(G,{sx:{color:((c=Y.appOrig)==null?void 0:c.appTarget)==="backend"?(b=W)==null?void 0:b.palette.primary.main:"inherit"},onClick:()=>{s(fe({})),n(E.FORM)},children:((R=Y.appOrig)==null?void 0:R.appTarget)==="backend"?e.jsx(mt,{}):e.jsx(gt,{})})})},ce={};return _()&&(ce.visibility="hidden"),e.jsxs(xt,{theme:w,children:[e.jsxs(l,{className:"pp-applist",sx:{width:"100%",visibility:_()?"hidden":"visible",position:_()?"fixed":"auto",height:_()?0:"auto",..._()&&{"& *":{visibility:"hidden"}},"& .pp-app-details":{...ce}},children:[e.jsx(je,{position:"relative",sx:{margin:"0 0 5px 0"},children:e.jsxs(Ae,{className:"pp-applist-toolbar",sx:{display:"grid",gap:"12px",paddingRight:"12px !important",...d?{gap:0,paddingRight:"10px",paddingBottom:"10px",paddingLeft:"10px","& .pp-applist-search":{gridTemplateColumns:"1fr",gridGap:"2px"}}:{...i?{gap:0,paddingRight:"10px",paddingBottom:"10px",paddingLeft:"10px","& .pp-applist-search":{justifyContent:"space-between",gridTemplateColumns:"auto 1fr"}}:{justifyContent:"space-between",gridTemplateColumns:"1fr 1fr"}}},children:[e.jsxs(l,{className:"pp-applist-title",sx:{display:"inline-grid",gridTemplateColumns:"auto auto",justifyContent:"start",alignItems:"center",gridGap:"10px"},children:[e.jsx(l,{children:((ue=Y.appOrig)==null?void 0:ue.appTarget)==="backend"?"":"Apps"}),e.jsx(l,{children:Ne()})]}),e.jsxs(l,{className:"pp-applist-search",sx:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"10px",justifyContent:"end",alignItems:"center"},children:[e.jsx(q,{value:u,type:"search",placeholder:"Search",disabled:a===E.FORM,onChange:c=>{s(Ke({dbSearch:c.target.value}))},sx:{backgroundColor:"#fff",fontSize:"1em",margin:0,padding:0,borderRadius:"4px","&.MuiFormControl-root.MuiTextField-root .MuiInputBase-root":{paddingRight:0},"&.MuiFormControl-root.MuiTextField-root input":{padding:"8px"}},InputProps:{startAdornment:e.jsx(Gt,{position:"end",sx:{fontSize:"1.5rem",padding:0,margin:0},children:e.jsx(ht,{})})}}),e.jsx(ie,{multiple:!0,size:"small",options:T,getOptionLabel:c=>c.text,isOptionEqualToValue:(c,b)=>c.id===b.id,value:t,disableCloseOnSelect:!0,disabled:a===E.FORM,onChange:(c,b)=>{s(Qe({dbTypes:b.map(R=>({id:R.id,text:Object.values(Xe)[R.id]}))}))},PaperComponent:({children:c})=>e.jsx(Ot,{sx:{width:`${C}px`},children:c}),renderOption:(c,b,{selected:R})=>e.jsxs("li",{...c,children:[e.jsx(qt,{style:{marginRight:8},checked:R}),b.text]}),renderInput:c=>e.jsx(l,{ref:v,children:e.jsx(q,{...c,sx:{minWidth:"250px","& .MuiInputBase-root":{backgroundColor:"#fff",padding:"0",maxHeight:"39px",overflow:"hidden"},"& .MuiButtonBase-root.MuiChip-root.MuiAutocomplete-tag":{height:"auto"}},placeholder:t.length===0?"Select app types":""})})})]})]})}),a===E.TABLE&&e.jsx(Kt,{apps:m,search:u,types:t,isLoading:z}),a===E.FORM&&e.jsx(Qt,{setMode:n}),g!==0&&g!==void 0&&e.jsx(Zt,{appDbId:g})]}),h.isActive===!0&&h.appDbId>0&&e.jsx(Pt,{appId:o,appDbId:h.appDbId,designMode:!0})]})};export{Is as default};
