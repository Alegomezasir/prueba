import{r as c,_ as h,bv as he,l,aH as je,av as j,bw as ne,bx as Se,by as Ce,bz as ae,aX as Ee,bA as ye,j as n,P as Me,aT as we,bB as Fe,C as _,e as d,bC as Te,bD as T,bE as re,bF as ke}from"./main-1.0.4.js";import{b as S,u as Ae,v as Re,f as oe,B as k,V as Pe,S as A,h as Le,H as Ve,a0 as le,a1 as Ye,Y as Be,n as Oe}from"./main-1.0.4-3f927327.js";import{a as De}from"./AdminTheme-1.0.4-e85d4fc0.js";import{s as Ne,u as ze,i as He}from"./ActionsDml-1.0.4-1a4856d6.js";import{d as y}from"./dayjs.min-1.0.4-2ecacb3f.js";import{C as Ue,a as Ge,B as v}from"./CardContent-1.0.4-55ef4296.js";import{C as $e}from"./CardActions-1.0.4-7d413e01.js";c.lazy(()=>h(()=>import("./TableContainer-1.0.4-e085ec9c.js").then(r=>r.T),["./TableContainer-1.0.4-e085ec9c.js","./main-1.0.4.js","./AdminTheme-1.0.4-e85d4fc0.js","./iconBase-1.0.4-684ba590.js","./main-1.0.4-3f927327.js","./main-1.0.4-ca6efa15.css","./index.esm-1.0.4-862c3851.js","./Close-1.0.4-ca2bff70.js","./TextField-1.0.4-6b1bbbfd.js","./colorManipulator-1.0.4-6ca57637.js","./FormControlLabel-1.0.4-64c2f78b.js","./CardContent-1.0.4-55ef4296.js","./MenuItem-1.0.4-50d14a51.js","./TabPanel-1.0.4-14af6bd6.js","./DialogContent-1.0.4-604ea0cd.js","./Tabs-1.0.4-276a4db7.js","./TabPanel-1.0.4-5a196fc8.css","./Radio-1.0.4-bd38ebb7.js","./Checkbox-1.0.4-04061c16.js","./AlertTitle-1.0.4-103cc369.js","./useSlot-1.0.4-77de692c.js","./InputAdornment-1.0.4-7c5d0d8f.js","./DateTimePicker-1.0.4-20c15877.js","./useMobilePicker-1.0.4-98bcd65f.js","./date-time-utils-1.0.4-cff519f0.js","./dateViewRenderers-1.0.4-e82b214f.js","./TimePicker-1.0.4-46bc9359.js","./DatePicker-1.0.4-29fd3332.js","./ScopeEnum-1.0.4-3d855cbf.js","./ActionsDml-1.0.4-1a4856d6.js","./useStoreTable-1.0.4-d7e93f06.js","./index.esm-1.0.4-1e92c0c7.js","./index-1.0.4-57a42597.js","./vi-1.0.4-f5e66e81.js","./dayjs.min-1.0.4-2ecacb3f.js","./TableContainer-1.0.4-04aa7508.css"],import.meta.url));c.lazy(()=>h(()=>Promise.resolve().then(()=>ie),void 0,import.meta.url));c.lazy(()=>h(()=>Promise.resolve().then(()=>ie),void 0,import.meta.url));const qe=r=>{const u=S(f=>he(f,r));return l.debug("moreState",u),u};const Je=c.lazy(()=>h(()=>import("./Row-1.0.4-6db0abf9.js"),["./Row-1.0.4-6db0abf9.js","./main-1.0.4.js","./main-1.0.4-3f927327.js","./iconBase-1.0.4-684ba590.js","./main-1.0.4-ca6efa15.css","./AdminTheme-1.0.4-e85d4fc0.js","./ActionsDml-1.0.4-1a4856d6.js","./dayjs.min-1.0.4-2ecacb3f.js","./CardContent-1.0.4-55ef4296.js","./CardActions-1.0.4-7d413e01.js"],import.meta.url)),Qe=c.lazy(()=>h(()=>import("./Alert-1.0.4-09b90733.js"),["./Alert-1.0.4-09b90733.js","./main-1.0.4.js","./index.esm-1.0.4-53f8e071.js","./iconBase-1.0.4-684ba590.js","./AdminTheme-1.0.4-e85d4fc0.js","./AlertTitle-1.0.4-103cc369.js","./Close-1.0.4-ca2bff70.js","./useSlot-1.0.4-77de692c.js"],import.meta.url)),We=({appId:r,primaryKey:u,formMode:f,showTable:x,showForm:M,detailKey:C})=>{var H,U,G,$,q,J,Q,W,X,Z,I,K;l.debug(r,u,f,C);const g=Ae(),E=c.useMemo(()=>Re(),[]),[ce,w]=c.useState(!1),[R,P]=c.useState(!1),[L,ue]=c.useState(""),e=c.useMemo(()=>je(j.getState(),r),[r]);l.debug("metaData",e);const b=((U=(H=e==null?void 0:e.app)==null?void 0:H.container[0])==null?void 0:U.cnt_relation)!==void 0&&(($=(G=e==null?void 0:e.app)==null?void 0:G.container[0])==null?void 0:$.cnt_relation)!==null&&((J=(q=e==null?void 0:e.app)==null?void 0:q.container[0])==null?void 0:J.cnt_relation)!==""?JSON.parse((W=(Q=e==null?void 0:e.app)==null?void 0:Q.container[0])==null?void 0:W.cnt_relation):{};l.debug("relation",b);const F=S(a=>ne(a,r));l.debug("data",F);const V=S(a=>Se(a,r));l.debug("initialData",V),c.useEffect(()=>{u===null?de():Object.keys(u).length>0?me():w(!0)},[u]);const me=()=>{Ne(r,u,e==null?void 0:e.media,a=>{if(l.debug(a),a!==null){const s={...a.context};delete s.debug;const t={...a.data[0]};g(ae({appId:r,data:t,context:s})),w(a!==null)}else d(_.contactSupport,{variant:"error"})},a=>{l.error("error",a),ue(a??_.contactSupport)})},de=()=>{var a,s;if(e.columns&&Array.isArray(e.columns)){const t={},m=Ce(j.getState(),r);l.debug("defaultValues",m);for(let o=0;o<e.columns.length;o++)t[e.columns[o].column_name]=null,m[e.columns[o].column_name]!==void 0&&(m[e.columns[o].column_name]==="@wpda_wp_user_id"?t[e.columns[o].column_name]=(s=(a=e==null?void 0:e.settings)==null?void 0:a.env)==null?void 0:s.id:m[e.columns[o].column_name]==="@now"?e.columns[o]==="date"?t[e.columns[o].column_name]=y(Date.now()).format("YYYY-MM-DD"):t[e.columns[o].column_name]=y(Date.now()).format("YYYY-MM-DD HH:mm:ss"):e.columns[o].column_default!==null&&e.columns[o].column_default!==""?e.columns[o].column_default==="CURRENT_TIMESTAMP"?e.columns[o]==="date"?t[e.columns[o].column_name]=y(Date.now()).format("YYYY-MM-DD"):t[e.columns[o].column_name]=y(Date.now()).format("YYYY-MM-DD HH:mm:ss"):t[e.columns[o].column_name]=e.columns[o].column_default:t[e.columns[o].column_name]=m[e.columns[o].column_name]);l.debug(t),g(ae({appId:r,data:t})),l.debug("init"),w(!0)}},Y=()=>{let a="";for(const s in e.columns)e.columns[s].extra==="auto_increment"&&(a=e.columns[s].column_name);return l.debug(a),a},fe=a=>{for(let s=0;s<e.columns.length;s++)if(e.columns[s].column_name===a)return e.columns[s]},ge=a=>{const s=Te(j.getState(),r);l.debug("rowValidation",s);let t=!1;for(const i in s)if(s[i].error===!0&&s[i].type===T.COLUMN){t=!0;break}if(t)return l.debug("validateForm returned errors"),!1;let m=!0;const o=Y();for(const i in a){const ee=fe(i);let te=!0;ee.column_name!==o&&ee.is_nullable==="NO"&&(a[i]===""&&(f===le.INSERT||p.preserveSpacesOnUpdate===!1)||a[i]===null||a[i]===void 0)&&(g(re({appId:r,columnName:i,columnError:!0,columnText:"Field must be entered",columnType:T.FORM})),te=!1,m=!1);const ve=ke(j.getState(),r,i);l.debug(ve),te&&g(re({appId:r,columnName:i,columnError:!1,columnText:"",columnType:T.FORM}))}return m},B=a=>{const s=ne(j.getState(),r);ge(s)&&(u!==null?ze(r,u,s,t=>{if(l.debug(t),t!=null&&t.code&&(t!=null&&t.message))switch(t.code){case"ok":P(!0),d(t.message,{variant:"success"}),a&&setTimeout(()=>{x(!0)},1e3);break;case"info":d(t.message,{variant:"info"}),a&&setTimeout(()=>{x(!0)},1e3);break;default:l.error(t),d(t.message??_.contactSupport,{variant:"error"}),a&&x(R)}else l.error(t),d(_.contactSupport,{variant:"error"})},t=>{l.error("error",t),d(t??_.contactSupport,{variant:"error"})}):He(r,s,t=>{if(l.debug(t),t!=null&&t.code&&(t!=null&&t.message)){let m;const o={};switch(t.code){case"ok":if(P(!0),d(t.message,{variant:"success"}),a){x(!0);return}m=Y();for(let i=0;i<e.primary_key.length;i++)m!==""?o[e.primary_key[i]]=t.context.insert_id:o[e.primary_key[i]]=s[e.primary_key[i]];l.debug(o),M(o,Ye.UPDATE);break;default:l.error(t),d(t.message??_.contactSupport,{variant:"error"})}}else l.error(t),d(_.contactSupport,{variant:"error"})},t=>{l.error("error",t),d(t??_.contactSupport,{variant:"error"})}))},_e=()=>{B(!1)},xe=()=>{B(!0)},O=()=>{x(R)},p=S(a=>Ee(a,r));l.debug("formSettings",p);const D=S(a=>ye(a,r));l.debug("moreEnabled",D);const N=qe(r);oe("(max-width: 600px)"),oe("(max-width: 900px)");const be={paddingTop:"50px",paddingBottom:"50px",paddingLeft:"50px",paddingRight:"50px"};let z="30px",pe="0";return L!==""?n.jsx(c.Suspense,{children:n.jsx(Qe,{severity:"error",message:L,close:!1})}):n.jsx("div",{className:`${r}_wrapper pp-form`,children:ce&&F!==null?n.jsxs(Ue,{sx:be,children:[n.jsx(Ge,{sx:{padding:0,margin:"5px 0 0 0"},children:n.jsx("form",{id:E,className:"pp-form-content",onSubmit:a=>(a.preventDefault(),!1),children:n.jsx(k,{className:"pp-form-grid",sx:{display:"grid",gridTemplateColumns:{lg:`repeat(${p.cellsPerRow}, 1fr)`,md:"repeat("+Math.min(p.cellsPerRow,2)+", 1fr)",xs:"1fr"},gap:z,marginBottom:0,background:p.showGrid?((X=Pe)==null?void 0:X.palette.mode)===Me.LIGHT?"repeating-linear-gradient( -45deg, transparent, transparent 10px, #eee 10px, #eee 20px )":"repeating-linear-gradient( -45deg, transparent, transparent 10px, #111 10px, #111 20px )":""},children:n.jsx(c.Suspense,{fallback:n.jsx(A,{}),children:n.jsx(Je,{appId:r,metaData:e,data:F,initialData:V,primaryKey:u,formMode:f,formSettings:p})})})})}),n.jsxs($e,{sx:{marginTop:z,padding:0,paddingRight:pe,justifyContent:"space-between",alignItems:"center"},children:[n.jsxs(k,{sx:{display:"flex",gap:"8px"},children:[((Z=e==null?void 0:e.app)==null?void 0:Z.container[0].cnt_relation)!==void 0&&((I=e==null?void 0:e.app)==null?void 0:I.container[0].cnt_relation)!==null&&((K=e==null?void 0:e.app)==null?void 0:K.container[0].cnt_relation)!==""&&n.jsx(v,{variant:"contained",className:"pp-builder-button",startIcon:n.jsx(Le,{}),onClick:()=>{g(we({appId:r}))},children:"Form Builder"}),D&&n.jsx(v,{variant:"outlined",startIcon:n.jsx(Ve,{}),onClick:()=>{g(Fe({appId:r,more:!N}))},children:N?"Less":"More"})]}),n.jsx(k,{children:f!==le.VIEW?n.jsxs(n.Fragment,{children:[n.jsx(v,{variant:"contained",onClick:_e,type:"submit",form:E,children:"APPLY"}),(b==null?void 0:b.cardinality)!==0&&n.jsxs(n.Fragment,{children:[n.jsx(v,{variant:"outlined",onClick:xe,sx:{marginLeft:"8px"},children:"OK"}),n.jsx(v,{variant:"outlined",onClick:O,sx:{marginLeft:"8px"},children:"CANCEL"})]})]}):n.jsx(n.Fragment,{children:(b==null?void 0:b.cardinality)!==0&&n.jsx(v,{variant:"contained",onClick:O,children:"BACK"})})})]}),n.jsx(n.Fragment,{children:!1})]}):n.jsx("div",{style:{padding:"50px"},children:n.jsx(A,{title:"Loading data..."})})})},Xe=c.lazy(()=>h(()=>import("./Settings-1.0.4-ee485146.js"),["./Settings-1.0.4-ee485146.js","./main-1.0.4.js","./main-1.0.4-3f927327.js","./iconBase-1.0.4-684ba590.js","./main-1.0.4-ca6efa15.css","./AdminTheme-1.0.4-e85d4fc0.js","./useMetadataColumns-1.0.4-ef7a068d.js","./useStoreTable-1.0.4-d7e93f06.js","./CardContent-1.0.4-55ef4296.js","./index.esm-1.0.4-15c38c3e.js","./ActionsDml-1.0.4-1a4856d6.js","./index.esm-1.0.4-1e92c0c7.js","./TextField-1.0.4-6b1bbbfd.js","./Close-1.0.4-ca2bff70.js","./MenuItem-1.0.4-50d14a51.js","./index-1.0.4-6dbd728b.js","./useTableUpdater-1.0.4-77e86903.js","./Stepper-1.0.4-274e952c.js","./TabPanel-1.0.4-14af6bd6.js","./FormControlLabel-1.0.4-64c2f78b.js","./DialogContent-1.0.4-604ea0cd.js","./Tabs-1.0.4-276a4db7.js","./TabPanel-1.0.4-5a196fc8.css","./Checkbox-1.0.4-04061c16.js","./AccordionSummary-1.0.4-dffa253b.js","./useSlot-1.0.4-77de692c.js","./PremiumFeature-1.0.4-532b0a19.js","./EnumTypeEnum-1.0.4-7ffcf33a.js","./ScopeEnum-1.0.4-3d855cbf.js","./RadioGroup-1.0.4-078a1a14.js","./Radio-1.0.4-bd38ebb7.js","./Link-1.0.4-4f39d399.js","./CssUnitTextField-1.0.4-c752a7df.js","./colorManipulator-1.0.4-6ca57637.js","./ComponentDatabase-1.0.4-efe98b3e.js","./ActionsApp-1.0.4-2e836240.js","./ActionsExplorer-1.0.4-d9d7ac7b.js","./ThemeSettings-1.0.4-6a68009a.js","./index-1.0.4-57a42597.js"],import.meta.url)),se=({appId:r,primaryKey:u,formMode:f,showTable:x,showForm:M,metaData:C,detailKey:g})=>{l.debug(r,u,f,C,g);const E=De();return n.jsxs(n.Fragment,{children:[n.jsx(We,{appId:r,primaryKey:u,formMode:f,showTable:x,showForm:M,detailKey:g}),Be(C)&&n.jsx(Oe,{theme:E,children:n.jsx(c.Suspense,{fallback:n.jsx(A,{title:"Loading form settings..."}),children:n.jsx(Xe,{appId:r})})})]})},ie=Object.freeze(Object.defineProperty({__proto__:null,FormContainer:se,default:se},Symbol.toStringTag,{value:"Module"}));export{ie as F,qe as u};
