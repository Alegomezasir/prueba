import{l,r as p,cl as j,A as F,j as r,e as h,C as x,cm as W,cn as v,co as L,cp as N,cq as P,cr as S,cs as w,ct as R,cu as B,cv as q,cw as z,cx as I,cy as O,cz as V,cA as y}from"./main-1.0.4.js";import{u as C,B as T,a as H,b as f}from"./main-1.0.4-3f927327.js";import{A as U}from"./AdminTheme-1.0.4-e85d4fc0.js";import{j as G}from"./ActionsApp-1.0.4-2e836240.js";import{F as g,b as J,a as D,A,T as k}from"./TextField-1.0.4-6b1bbbfd.js";import{P as K}from"./iconBase-1.0.4-684ba590.js";import{F as Q}from"./FormControlLabel-1.0.4-64c2f78b.js";import{C as X}from"./Checkbox-1.0.4-04061c16.js";import{d as M,e as _,h as Y}from"./ActionsExplorer-1.0.4-d9d7ac7b.js";const oa=({app:e})=>{l.debug(e);const n=C(),[u,d]=p.useState(!1),o=p.useRef(!0);p.useEffect(()=>{o.current?o.current=!1:e.appDatabase!==null&&e.appTable!==null?(d(!0),G(e.appDatabase,e.appTable,!1,function(s){const c=s==null?void 0:s.data;if(l.debug("response data",e.appDatabase,e.appTable,c),!c.columns)h(x.contactSupport,{variant:"error"});else{const i=[];c.columns.map(b=>{b.column_name!==void 0&&i.push({columnName:b.column_name,isSelected:!0})}),n(W({appColumns:i,appMetaData:c}))}d(!1)},s=>{l.error("error",s),h(s??x.contactSupport,{variant:"error"}),d(!1)})):n(j({appColumns:[]}))},[e.appDatabase,e.appTable,n]);const[t,a]=p.useState(!1);return l.debug("hasErrors",t),p.useEffect(()=>{Number(e.appType)!==F.DATATABLE&&e.appMetaData.primary_key!==void 0?a(e.appMetaData.primary_key.length===0||e.appMetaData.primary_key.filter(s=>e.appColumns.filter(i=>i.isSelected).map(i=>i.isSelected?i.columnName:!1).includes(s)).length!==e.appMetaData.primary_key.length):a(!1)},[e]),r.jsxs(g,{fullWidth:!0,children:[r.jsxs(T,{component:"fieldset",sx:{borderWidth:1,borderRadius:"4px","& .MuiPaper-root":{border:"none",padding:"15px 20px"},"& .MuiFormHelperText-root":{marginLeft:"20px",marginBottom:"20px"}},children:[r.jsx("legend",{style:{fontSize:"0.75rem",fontWeight:400,color:"rgba(0, 0, 0, 0.6)"},children:"Select columns *"}),r.jsxs(K,{variant:"outlined",sx:{padding:"15px 30px"},children:[e.appColumns.length===0&&r.jsx(g,{fullWidth:!0,sx:{margin:"5px 0"},children:r.jsx(J,{sx:{color:"inherit"},children:"No table selected"})}),...e.appColumns.map((s,c)=>{var i;return r.jsx(Q,{control:r.jsx(X,{checked:s.isSelected,onChange:(b,m)=>{n(j({appColumns:[...e.appColumns.slice(0,c),{columnName:s.columnName,isSelected:m},...e.appColumns.slice(c+1)]}))}}),label:r.jsx(T,{sx:{color:t&&e.appMetaData.primary_key.includes(s.columnName)?(i=U)==null?void 0:i.palette.error.main:""},children:s.columnName+(t&&e.appMetaData.primary_key.includes(s.columnName)?" (primary key column)":"")}),sx:{width:"100%"}})})]})]}),r.jsx(D,{children:"Only selected columns are available in tables and forms. Unselected columns are excluded from responses. At least one column must be selected."}),!u&&e.appDatabase!==null&&e.appTable!==null&&t&&r.jsxs(D,{error:!0,sx:{marginTop:"20px",width:"fit-content",display:"inline-grid",gridTemplateColumns:"40px auto",justifyContent:"space-around",alignItems:"center"},children:[r.jsx(H,{size:"24px"}),r.jsx("span",{children:e.appMetaData.primary_key.length===0?r.jsx(r.Fragment,{children:"This table contains no primary key. Transactions are not supported for tables without a primary key. Please create a primary key to continue or select app type Data Table in the app info tab."}):r.jsxs(r.Fragment,{children:["Transactions require all primary key columns to be selected. With the current settings transactions will be disabled for table ",e.appTable,"."]})})]})]})},ia=()=>{const e=C(),n=f(t=>v(t));l.debug("appDatabase",n);const u=f(t=>L(t));l.debug("tables",u);const d=f(t=>N(t));l.debug("views",d);const o=f(t=>P(t));return l.debug("appTable",o),p.useEffect(()=>{n!==null&&(u.length===0||d.length===0)&&(M(n,function(t){const a=t==null?void 0:t.data;l.debug("response data",a),e(S({tables:a}))},t=>{l.error("error",t),h(t??x.contactSupport,{variant:"error"})}),_(n,function(t){const a=t==null?void 0:t.data;l.debug("response data",a),e(w({views:a}))},t=>{l.error("error",t),h(t??x.contactSupport,{variant:"error"})}))},[n]),r.jsxs(g,{sx:{width:"100%",marginTop:"8px"},children:[r.jsx(A,{options:n!==null?u.concat(d).sort():[],value:o,onChange:(t,a)=>{e(R({appTable:a??null}))},renderInput:t=>r.jsx(k,{...t,label:"Table *",variant:"outlined"}),sx:{width:"100%"}}),r.jsx(D,{children:"Select a table from the list (additional tables can be added in the Table Builder)"})]})},ca=()=>{const e=C(),n=f(a=>B(a));l.debug("databases",n);const u=f(a=>q(a));l.debug("wpDatabase",u);const d=f(a=>z(a));l.debug("defaultDatabase",d);const o=f(a=>v(a));l.debug("appDatabase",o),p.useEffect(()=>{n.length===0?Y(function(a){const s=a==null?void 0:a.data;l.debug("response data",s);const c=[];let i="",b="";s.map(m=>{c.push(m.dbs),m.dbs_type.toLocaleLowerCase()==="wp"&&(i=m.dbs,b=m.dbs)}),c.sort((m,E)=>m.localeCompare(E,void 0,{sensitivity:"base"})),e(I({databases:c})),e(O({wpDatabase:i})),e(V({defaultDatabase:b})),o===null&&e(y({appDatabase:b})),l.debug(c,i,b)},a=>{l.error("error",a),h(a??x.contactSupport,{variant:"error"})}):o===null&&e(y({appDatabase:d}))},[]);const t=p.useRef(!0);return p.useEffect(()=>{t.current?t.current=!1:o!==null&&n.includes(o)&&(M(o,function(a){const s=a==null?void 0:a.data;l.debug("response data",s),e(S({tables:s}))},a=>{l.error("error",a),h(a??x.contactSupport,{variant:"error"})}),_(o,function(a){const s=a==null?void 0:a.data;l.debug("response data",s),e(w({views:s}))},a=>{l.error("error",a),h(a??x.contactSupport,{variant:"error"})}))},[o]),r.jsxs(g,{sx:{width:"100%",marginTop:"8px"},children:[r.jsx(A,{options:n,value:o,onChange:(a,s)=>{e(y({appDatabase:s??null}))},getOptionLabel:a=>u===a?"WordPress database ("+a+")":a,renderInput:a=>r.jsx(k,{...a,label:"Database *",variant:"outlined"}),renderOption:(a,s)=>r.jsxs(T,{component:"li",sx:{"& > img":{mr:2,flexShrink:0}},...a,children:[s," ",u===s?" (WordPress database)":""]}),sx:{width:"100%"}}),r.jsx(D,{children:"Select a database from the list"})]})};export{ca as C,ia as a,oa as b};
