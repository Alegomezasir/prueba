import{aH as Le,l as r,r as C,aO as we,av as D,bX as pe,bY as Ee,bZ as Ve,b_ as Oe,b$ as _e,aX as Fe,j as e,c0 as ie,c1 as Ge,c2 as Ne,_ as Be,c3 as We,t as q,c4 as ne,c5 as ze,c6 as qe,c7 as He,c8 as Je,c9 as Ye,ca as j,cb as Xe,cc as Q,cd as se,c as Ke,ce as Ze,a as $e,e as U,C as H,cf as De,cg as re,aY as Qe,P as Ie,ch as Me,k as fe,m as es,ci as ss,cj as ts,ck as is}from"./main-1.0.4.js";import{b as G,u as _,v as ns,M as N,B as f,U as ue,O as rs,ag as ls,a7 as be,ah as as,aa as os,ab as ds,ac as cs,ad as ps,D as us,T as Ce,e as Ue,k as xs,l as gs,m as ke,ai as hs,p as ms,A as js,d as fs}from"./main-1.0.4-3f927327.js";import{A as ye}from"./AdminTheme-1.0.4-e85d4fc0.js";import{u as bs,S as Cs,a as ys,I as ee,b as Ss,c as Ts,d as le,T as vs,M as ws,P as _s,D as Fs,e as Us,f as ks,g as Rs,h as Ps,i as As}from"./useMetadataColumns-1.0.4-ef7a068d.js";import{a as $,C as me,S as Re,R as Ls,B as Es,b as Vs,c as Os,d as Gs,e as ae,i as Ns}from"./TabPanel-1.0.4-14af6bd6.js";import{h as Bs,f as Ws,g as zs}from"./index.esm-1.0.4-1e92c0c7.js";import{u as Pe}from"./useStoreTable-1.0.4-d7e93f06.js";import{d as qs,e as Hs,c as Js}from"./index.esm-1.0.4-15c38c3e.js";import{P as K}from"./PremiumFeature-1.0.4-532b0a19.js";import{E as oe}from"./EnumTypeEnum-1.0.4-7ffcf33a.js";import{A as B,a as W,b as z}from"./AccordionSummary-1.0.4-dffa253b.js";import{F as w,b as R,a as F,T as A,I as xe,S as ge}from"./TextField-1.0.4-6b1bbbfd.js";import{a as Ys,S as Xs}from"./ScopeEnum-1.0.4-3d855cbf.js";import{R as he}from"./RadioGroup-1.0.4-078a1a14.js";import{R as O}from"./Radio-1.0.4-bd38ebb7.js";import{L as Se}from"./Link-1.0.4-4f39d399.js";import{I as Y,T as Ks}from"./iconBase-1.0.4-684ba590.js";import{F as I}from"./FormControlLabel-1.0.4-64c2f78b.js";import{C as k,D as Zs,T as $s,a as de}from"./CssUnitTextField-1.0.4-c752a7df.js";import{C as Ds,a as Qs,b as Is}from"./ComponentDatabase-1.0.4-efe98b3e.js";import{M}from"./MenuItem-1.0.4-50d14a51.js";import{g as Ms,h as et,i as st}from"./ActionsApp-1.0.4-2e836240.js";import{B as J,C as Te,a as ve}from"./CardContent-1.0.4-55ef4296.js";import{S as tt,a as it,b as nt}from"./Stepper-1.0.4-274e952c.js";import"./index-1.0.4-6dbd728b.js";import rt from"./ThemeSettings-1.0.4-6a68009a.js";import{T as ce}from"./Tabs-1.0.4-276a4db7.js";import"./ActionsDml-1.0.4-1a4856d6.js";import"./useTableUpdater-1.0.4-77e86903.js";import"./Checkbox-1.0.4-04061c16.js";import"./Close-1.0.4-ca2bff70.js";import"./DialogContent-1.0.4-604ea0cd.js";import"./useSlot-1.0.4-77de692c.js";import"./colorManipulator-1.0.4-6ca57637.js";import"./ActionsExplorer-1.0.4-d9d7ac7b.js";import"./index-1.0.4-57a42597.js";const te=s=>{const n=G(i=>Le(i,s));return r.debug("metaData",n),n},lt=s=>{const n=_();return C.useCallback((i,t)=>{Ms({app_id:i.app.app[0].app_id,cnt_id:i.app.container[0].cnt_id},l=>{const c=l==null?void 0:l.data;if(r.debug("response data",c),Array.isArray(c)){const d=we(D.getState(),s)??[];for(let p=0;p<c.length;p++)if((c[p].cnt_relation===void 0||c[p].cnt_relation===null||c[p].cnt_relation===""?{}:JSON.parse(c[p].cnt_relation)).cnt_id_master===i.app.container[0].cnt_id){let a="";for(let o=0;o<d.length;o++)pe(D.getState(),d[o].appId)!==void 0&&d[o].container.cnt_id===c[p].cnt_id&&(a=d[o].appId);if(a===""){const o={appId:ns(),container:c[p]};n(Ee({appId:s,detail:o}))}else{const o={appId:a,container:c[p]};n(Ve({appId:s,detail:o}))}}}else r.error("error loading details",l),t!==void 0&&t()},l=>{r.error("error loading details",l),t!==void 0&&t()})},[s])},at=s=>{const n=G(i=>Oe(i,s));return r.debug("detailDisplayType",n),n},L=s=>{const n=_();return t=>{n(_e({appId:s,isUpdated:t}))}},ot=s=>{const n=G(i=>Fe(i,s));return r.debug("storeFormSettings",n),n},dt=({appId:s,columnIndex:n,tableColumn:i})=>{r.debug(s,n,i),_();const t=te(s),l=ot(s);L(s);const c=d=>[];return e.jsxs(B,{disableGutters:!0,children:[e.jsxs(W,{expandIcon:e.jsx(N,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(qs,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Grid positioning"})]}),e.jsxs(z,{sx:{paddingTop:"0.5rem"},children:[e.jsxs(f,{children:[e.jsxs(w,{sx:{display:"grid"},children:[e.jsx(R,{children:"Grid cells"}),e.jsx(Ys,{value:i.cells,min:1,max:l.cellsPerRow,step:1,marks:c(l.cellsPerRow),valueLabelDisplay:"off",disabled:!0,onChange:(d,p)=>{r.debug(d,p)},sx:{width:"calc(100% - 40px)",margin:"20px"}})]}),e.jsx(F,{children:"Number of grid cells used (can be changed in FORM > Grid)"}),e.jsxs(w,{sx:{width:"100%"},children:[e.jsx(R,{sx:{margin:"15px 0 5px 0"},children:"Grid positioning"}),e.jsx(he,{sx:{flexDirection:"column",alignContent:"flex-start",marginLeft:"10px",marginBottom:"5px"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",justifyContent:"center",alignItems:"center"},children:[e.jsxs(R,{className:"align-label-radio",children:[e.jsx(O,{checked:i.cellClass===ie.AUTO,disabled:!0,onChange:d=>{d.stopPropagation()}}),"Auto"]}),e.jsxs(R,{className:"align-label-radio",children:[e.jsx(O,{checked:i.cellClass===ie.START,disabled:!0,onChange:d=>{d.stopPropagation()}}),"Start"]}),e.jsxs(R,{className:"align-label-radio",children:[e.jsx(O,{checked:i.cellClass===ie.END,disabled:!0,onChange:d=>{d.stopPropagation()}}),"End"]}),e.jsxs(R,{children:[e.jsx(O,{checked:typeof i.cellClass=="number",disabled:!0,onChange:d=>{d.stopPropagation()}}),"Add"]}),e.jsxs("div",{style:{marginLeft:"10px",gridColumn:"span 2",display:"grid",gridTemplateColumns:"auto auto",alignItems:"center"},children:[e.jsx(A,{id:"pp-cells-before",sx:{width:"60px"},className:"pp-cells-before",type:"number",defaultValue:1,InputProps:{inputProps:{min:1,max:l.cellsPerRow-1}},disabled:!0,InputLabelProps:{shrink:!0},onChange:d=>{d.stopPropagation()}}),e.jsx(R,{sx:{marginLeft:"10px"},children:"cell(s) before"})]})]})})]}),e.jsx(F,{children:"Grid positioning relative to surrounding cells"}),i.computedField&&n!==void 0&&(t==null?void 0:t.columns[n])!==void 0&&t.columns[n].data_type==="enum"&&e.jsxs(f,{sx:{marginTop:"20px"},children:[e.jsx(R,{children:"Show values in"}),e.jsxs(he,{sx:{flexDirection:"column",alignContent:"flex-start",margin:"10px 0 5px 10px"},children:[e.jsxs(R,{className:"align-label-radio",children:[e.jsx(O,{checked:i.updatableEnum===void 0||i.updatableEnum===oe.LIST,disabled:!0,onChange:d=>{d.stopPropagation()}}),"Drop-down List"]}),e.jsxs(R,{className:"align-label-radio",children:[e.jsx(O,{checked:i.updatableEnum===oe.RADIO_HORIZONTAL,disabled:!0,onChange:d=>{d.stopPropagation()}}),"Horizontal radio group"]}),e.jsxs(R,{className:"align-label-radio",children:[e.jsx(O,{checked:i.updatableEnum===oe.RADIO_VERTICAL,disabled:!0,onChange:d=>{d.stopPropagation()}}),"Vertical radio group"]})]})]})]}),e.jsx(K,{single:!1})]})]})},ct=({appId:s,columnIndex:n,tableColumn:i,columnMetaData:t})=>{r.debug(s,n,i),_(),L(s);const[l,c]=C.useState(!1);return i.computedField!==void 0||n===void 0||t===void 0||(t==null?void 0:t.data_type)!==void 0&&ue(t.data_type)!=="number"?null:e.jsxs(B,{disableGutters:!0,children:[e.jsxs(W,{expandIcon:e.jsx(N,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(Hs,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Validation"})]}),e.jsxs(z,{sx:{paddingTop:"1rem"},children:[e.jsxs(w,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},children:[e.jsx(A,{error:l,type:"number",label:"Minimum value allowed",disabled:!0,value:i.numericMin??"",required:!1,InputLabelProps:{shrink:!0},onChange:d=>{r.debug(d)}}),e.jsx(A,{error:l,type:"number",label:"Maximum value allowed",disabled:!0,value:i.numericMax??"",required:!1,InputLabelProps:{shrink:!0},onChange:d=>{r.debug(d)}})]}),e.jsx(K,{})]})]})},pt=({appId:s,columnIndex:n,tableColumn:i,columnMetaData:t})=>{r.debug(s,n,i,t);const l=_(),c=L(s),[d,p]=C.useState(!1),T={marginTop:"20px",marginLeft:"10px",fontWeight:"bold"};return e.jsxs(B,{disableGutters:!0,children:[e.jsxs(W,{expandIcon:e.jsx(N,{}),sx:{fontSize:"1rem","& .MuiAccordionSummary-content":{padding:"1rem",alignItems:"center"}},children:[e.jsx(Js,{}),e.jsx("span",{style:{paddingLeft:"0.5rem"},children:"Column settings"})]}),e.jsxs(z,{sx:{display:"grid",gridGap:"2rem",paddingTop:"1rem"},children:[e.jsxs(w,{children:[e.jsx(A,{type:"text",variant:"outlined",label:"Default value",value:i.defaultValue??"",placeholder:(t==null?void 0:t.column_default)??"",InputLabelProps:{shrink:!0},onChange:a=>{l(Ge({appId:s,index:n,defaultValue:a.target.value})),c(!0),a.stopPropagation()}}),e.jsxs(F,{component:"div",children:[e.jsx(e.Fragment,{children:(t==null?void 0:t.column_default)!==void 0&&(t==null?void 0:t.column_default)!==null&&(t==null?void 0:t.column_default)!==""&&e.jsx(f,{sx:{fontWeight:"bold"},children:"Leave empty to use column default constraint."})}),e.jsxs("div",{children:["Only applied on insert ",d?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:e.jsx(Se,{sx:{cursor:"pointer"},underline:"none",onClick:()=>{p(!1)},children:"(hide examples)"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Hello World"}),e.jsx("li",{children:"@wpda_wp_user_id"}),e.jsx("li",{children:"@now"})]}),e.jsx("div",{style:T,children:"Notes"}),e.jsxs("ul",{children:[e.jsx("li",{children:"@wpda_wp_user_id returns the WordPress user ID or 0 for anonymous requests"}),e.jsx("li",{children:"@now returns the current date/time and works with date/time fields only"}),e.jsxs("li",{children:["Column default constraints defined in the database are automatically applied",(t==null?void 0:t.column_default)!==void 0&&(t==null?void 0:t.column_default)!==null&&(t==null?void 0:t.column_default)!==""&&e.jsxs(e.Fragment,{children:[" (current value is ",e.jsx("strong",{children:t==null?void 0:t.column_default}),")"]})]})]})]}):e.jsx("span",{children:e.jsx(Se,{sx:{cursor:"pointer"},underline:"none",onClick:()=>{p(!0)},children:"(show examples)"})})]})]})]}),((t==null?void 0:t.data_type)!==void 0&&t.data_type.toLowerCase()!=="text"&&t.data_type.toLowerCase()!=="enum"&&t.data_type.toLowerCase()!=="set"&&t.column_type.toLowerCase()!=="tinyint(1)"&&(ue(t.data_type)==="string"||ue(t.data_type)==="number")||i.computedField)&&e.jsxs(w,{children:[e.jsx(f,{sx:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"10px",alignItems:"center"},children:e.jsxs(e.Fragment,{children:[e.jsx(A,{type:"text",variant:"outlined",label:"Prefix",value:i.prefix,disabled:!0,InputLabelProps:{shrink:!0},onChange:a=>{a.stopPropagation()}}),e.jsx(A,{type:"text",variant:"outlined",label:"Suffix",value:i.suffix,disabled:!0,InputLabelProps:{shrink:!0},onChange:a=>{a.stopPropagation()}})]})}),e.jsx(F,{children:"Adds a prefix and/or suffix to the column content"})]}),e.jsxs(w,{children:[e.jsx(A,{type:"text",variant:"outlined",label:"CSS classes",fullWidth:!0,value:i.classNames,disabled:!0,InputLabelProps:{shrink:!0},onChange:a=>{a.stopPropagation()}}),e.jsx(F,{children:"CSS classes (seperated by spaces) for custom styling"})]}),e.jsxs(w,{children:[e.jsx(A,{type:"text",variant:"outlined",label:"Hint",fullWidth:!0,value:i.hint,disabled:!0,InputLabelProps:{shrink:!0},onChange:a=>{a.stopPropagation()}}),e.jsx(F,{children:"Help text displayed below data entry field"})]}),e.jsx(K,{single:!1,margin:"0"})]})]})},ut=({appId:s,columnIndex:n,tableColumn:i})=>{var a,o;r.debug(s,n,i);const t=_(),l=Pe(s),c=te(s),p=bs(s)[i.columnName],T=(m,h)=>{t(Ne({appId:s,index:m,lookup:h}))};return e.jsxs(e.Fragment,{children:[e.jsx(dt,{appId:s,columnIndex:n,tableColumn:i}),e.jsx(pt,{appId:s,columnIndex:n,tableColumn:i,columnMetaData:p}),(((a=c==null?void 0:c.privs)==null?void 0:a.insert)||((o=c==null?void 0:c.privs)==null?void 0:o.update))&&(l.table.transactions.insert||l.table.transactions.update)&&e.jsx(ct,{appId:s,columnIndex:n,tableColumn:i,columnMetaData:p}),e.jsx(Cs,{appId:s,columnIndex:n,tableColumn:i,columnMetaData:p,setLookup:T}),e.jsx(ys,{columnMetaData:p})]})};C.lazy(()=>Be(()=>import("./ComputedFieldMore-1.0.4-242c2027.js"),["./ComputedFieldMore-1.0.4-242c2027.js","./main-1.0.4.js","./main-1.0.4-3f927327.js","./iconBase-1.0.4-684ba590.js","./main-1.0.4-ca6efa15.css","./TabPanel-1.0.4-14af6bd6.js","./FormControlLabel-1.0.4-64c2f78b.js","./TextField-1.0.4-6b1bbbfd.js","./Close-1.0.4-ca2bff70.js","./DialogContent-1.0.4-604ea0cd.js","./AdminTheme-1.0.4-e85d4fc0.js","./CardContent-1.0.4-55ef4296.js","./Tabs-1.0.4-276a4db7.js","./TabPanel-1.0.4-5a196fc8.css","./index.esm-1.0.4-1e92c0c7.js","./MenuItem-1.0.4-50d14a51.js"],import.meta.url));const xt=({appId:s,columnIndex:n})=>{r.debug(s,n);const i=_(),t=Pe(s),l=G(u=>We(u,s,n));r.debug("tableColumn",l);const c=L(s),d=(u,y)=>{r.debug(u,y),i(ze({appId:s,index:u,visible:y})),c(!0)},p=(u,y)=>{r.debug(u,y),i(qe({appId:s,index:u,more:y})),c(!0)},T=(u,y)=>{r.debug(u,y),i(He({appId:s,index:u,updatable:y})),c(!0)};rs.TEXT;const[a,o]=C.useState(!1),[m,h]=C.useState(void 0),S=u=>{u!==void 0&&(i(Je({appId:s,index:u})),c(!0))},P=(u,y,E)=>(r.debug(u,y,E),e.jsxs(e.Fragment,{children:[e.jsx(f,{children:e.jsx(Ss,{id:u,enabled:!1})}),e.jsxs(f,{sx:{display:"inline-grid",gridTemplateColumns:l.computedField!==void 0?"auto auto":"auto",justifyContent:"start",alignItems:"center",gap:"10px","& svg":{opacity:"0.5"}},children:[l.computedField!==void 0&&e.jsx(Bs,{}),e.jsx(R,{children:y})]})]}));return e.jsxs(e.Fragment,{children:[e.jsxs(B,{disableGutters:!0,slotProps:{transition:{unmountOnExit:!0}},children:[e.jsxs(W,{className:"pp-column-settings",expandIcon:e.jsx(N,{}),sx:{justifyContent:"space-between"},children:[e.jsx(f,{sx:{display:"grid",gridTemplateColumns:"auto 1fr",alignItems:"center","& svg":{display:"flex"}},children:P(l.columnName,l.columnLabel,n)}),e.jsxs(f,{style:{display:"grid",gridTemplateColumns:"40px 40px 40px"},children:[e.jsx($,{title:"Visibility",position:"bottom",children:e.jsx(Y,{onClick:u=>{l.visible?l.more?(d(n,!1),p(n,!1)):p(n,!0):l.more?p(n,!1):d(n,!0),u.stopPropagation()},children:l.visible?e.jsx(e.Fragment,{children:l.more?e.jsx(ee,{checked:!0,children:e.jsx(ls,{})}):e.jsx(ee,{checked:!0,children:e.jsx(be,{})})}):e.jsx(ee,{checked:!1,children:e.jsx(be,{})})})}),l.computedField?e.jsx(e.Fragment,{children:e.jsx($,{title:"Delete",position:"bottom",children:e.jsx(Y,{onClick:u=>{o(!0),h(n),u.stopPropagation()},children:e.jsx(os,{})})})}):e.jsx($,{title:"Updatable",position:"bottom",disabled:!t.table.transactions.insert&&!t.table.transactions.update,children:e.jsx(Y,{disabled:!t.table.transactions.insert&&!t.table.transactions.update,onClick:u=>{T(n,!l.updatable),u.stopPropagation()},children:e.jsx(ee,{checked:l.updatable&&(t.table.transactions.insert||t.table.transactions.update),disabled:!t.table.transactions.insert&&!t.table.transactions.update,children:e.jsx(as,{})})})}),e.jsx($,{title:"Alignment",position:"bottom",children:e.jsxs(Y,{onClick:u=>{l.alignment===q.LEFT?i(ne({appId:s,index:n,alignment:q.CENTER})):l.alignment===q.CENTER?i(ne({appId:s,index:n,alignment:q.RIGHT})):l.alignment===q.RIGHT&&i(ne({appId:s,index:n,alignment:q.LEFT})),c(!0),u.stopPropagation()},children:[l.alignment===q.LEFT&&e.jsx(ds,{}),l.alignment===q.CENTER&&e.jsx(cs,{}),l.alignment===q.RIGHT&&e.jsx(ps,{})]})})]})]}),e.jsx(z,{children:e.jsx(ut,{appId:s,columnIndex:n,tableColumn:l})})]},n),e.jsx(me,{title:"Delete computed field?",message:"Are you sure you want to delete this computed field? This action cannot be undone!",open:a,setOpen:o,onConfirm:()=>S(m)})]})},gt=({appId:s})=>{r.debug(s),_();const n=Ts(le(_s),le(ws),le(vs));L(s);const i=l=>{const{active:c,over:d}=l;(c==null?void 0:c.id)!==(d==null?void 0:d.id)&&r.debug(c,d)},t=G(l=>Ye(l,s));return t===void 0||t.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(Fs,{autoScroll:!0,sensors:n,collisionDetection:Us,onDragEnd:i,children:e.jsx(ks,{items:t,children:t.map((l,c)=>e.jsx(Rs,{id:l,children:e.jsx(xt,{appId:s,columnIndex:c})},l))})}),e.jsx(Ps,{appId:s,target:us.FORM})]})},ht=({appId:s,formSettings:n})=>(_(),L(s),e.jsxs(B,{defaultExpanded:!1,disableGutters:!0,children:[e.jsx(W,{expandIcon:e.jsx(N,{}),children:"Field layout"}),e.jsxs(z,{sx:{display:"grid"},children:[e.jsxs(w,{children:[e.jsxs(he,{value:n.fieldVariant,sx:{flexDirection:"row"},onChange:i=>{r.debug(i)},children:[e.jsx(I,{control:e.jsx(O,{disabled:!0}),value:"outlined",label:"Outlined"},"outlined"),e.jsx(I,{control:e.jsx(O,{disabled:!0}),value:"filled",label:"Filled"},"filled"),e.jsx(I,{control:e.jsx(O,{disabled:!0}),value:"standard",label:"Standard"},"standard")]}),e.jsx(F,{children:"Applies to data entry forms only"})]}),e.jsx(K,{})]})]})),mt=({appId:s,formSettings:n,updateSettings:i})=>(_(),L(s),e.jsxs(B,{defaultExpanded:!1,disableGutters:!0,children:[e.jsx(W,{expandIcon:e.jsx(N,{}),children:"Grid"}),e.jsxs(z,{sx:{display:"grid",gridTemplateColumns:"repeat(1, 1fr)",gap:"20px",marginTop:"5px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"},children:[e.jsx(A,{type:"number",label:"Cells per row",value:n.cellsPerRow,disabled:!0,InputLabelProps:{shrink:!0},onChange:t=>{r.debug(t)}}),e.jsx(k,{label:"Space between cells",textField:{cssValue:n.spacing.betweenCells,cssUnit:n.spacing.betweenCellsUnit},defaultValue:{cssValue:j.betweenCells,cssUnit:j.betweenCellsUnit},updateSettings:t=>{r.debug(t)}})]}),e.jsx(I,{control:e.jsx(Re,{disabled:!0,checked:n.showGrid,onChange:(t,l)=>{r.debug(t,l)}}),label:"Show grid"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginTop:"10px"},children:[e.jsx(k,{label:"Padding top",textField:{cssValue:n.spacing.aroundGridTop,cssUnit:n.spacing.aroundGridTopUnit},defaultValue:{cssValue:j.aroundGridTop,cssUnit:j.aroundGridTopUnit},updateSettings:t=>{r.debug(t)}}),e.jsx(k,{label:"Padding bottom",textField:{cssValue:n.spacing.aroundGridBottom,cssUnit:n.spacing.aroundGridBottomUnit},defaultValue:{cssValue:j.aroundGridBottom,cssUnit:j.aroundGridBottomUnit},updateSettings:t=>{r.debug(t)}}),e.jsx(k,{label:"Padding left",textField:{cssValue:n.spacing.aroundGridLeft,cssUnit:n.spacing.aroundGridLeftUnit},defaultValue:{cssValue:j.aroundGridLeft,cssUnit:j.aroundGridLeftUnit},updateSettings:t=>{r.debug(t)}}),e.jsx(k,{label:"Padding right",textField:{cssValue:n.spacing.aroundGridRight,cssUnit:n.spacing.aroundGridRightUnit},defaultValue:{cssValue:j.aroundGridRight,cssUnit:j.aroundGridRightUnit},updateSettings:t=>{r.debug(t)}})]}),e.jsx(K,{single:!1})]})]})),jt=({formSettings:s,updateSettings:n})=>e.jsxs(B,{defaultExpanded:!1,disableGutters:!0,children:[e.jsx(W,{expandIcon:e.jsx(N,{}),children:"Cells"}),e.jsxs(z,{style:{display:"grid",gridTemplateColumns:"repeat(1, 1fr)"},children:[e.jsxs(w,{children:[e.jsxs(f,{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginTop:"5px"},children:[e.jsx(k,{label:"Padding top",textField:{cssValue:s.spacing.cellTop,cssUnit:s.spacing.cellTopUnit},defaultValue:{cssValue:j.cellTop,cssUnit:j.cellTopUnit},updateSettings:i=>{r.debug(i)}}),e.jsx(k,{label:"Padding bottom",textField:{cssValue:s.spacing.cellBottom,cssUnit:s.spacing.cellBottomUnit},defaultValue:{cssValue:j.cellBottom,cssUnit:j.cellBottomUnit},updateSettings:i=>{r.debug(i)}}),e.jsx(k,{label:"Padding left",textField:{cssValue:s.spacing.cellLeft,cssUnit:s.spacing.cellLeftUnit},defaultValue:{cssValue:j.cellLeft,cssUnit:j.cellLeftUnit},updateSettings:i=>{r.debug(i)}}),e.jsx(k,{label:"Padding right",textField:{cssValue:s.spacing.cellRight,cssUnit:s.spacing.cellRightUnit},defaultValue:{cssValue:j.cellRight,cssUnit:j.cellRightUnit},updateSettings:i=>{r.debug(i)}})]}),e.jsx(F,{sx:{marginTop:"20px"},children:"Spacing around cells"})]}),e.jsx(K,{single:!1})]})]}),ft=({formSettings:s,updateSettings:n})=>e.jsxs(B,{defaultExpanded:!1,disableGutters:!0,children:[e.jsx(W,{expandIcon:e.jsx(N,{}),children:"Field spacing"}),e.jsxs(z,{sx:{display:"grid"},children:[e.jsxs(w,{children:[e.jsxs(f,{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginTop:"5px"},children:[e.jsx(k,{label:"Padding top",textField:{cssValue:s.spacing.fieldTop,cssUnit:s.spacing.fieldTopUnit},defaultValue:{cssValue:j.fieldTop,cssUnit:j.fieldTopUnit},updateSettings:i=>{r.debug(i)}}),e.jsx(k,{label:"Padding bottom",textField:{cssValue:s.spacing.fieldBottom,cssUnit:s.spacing.fieldBottomUnit},defaultValue:{cssValue:j.fieldBottom,cssUnit:j.fieldBottomUnit},updateSettings:i=>{r.debug(i)}}),e.jsx(k,{label:"Padding left",textField:{cssValue:s.spacing.fieldLeft,cssUnit:s.spacing.fieldLeftUnit},defaultValue:{cssValue:j.fieldLeft,cssUnit:j.fieldLeftUnit},updateSettings:i=>{r.debug(i)}}),e.jsx(k,{label:"Padding right",textField:{cssValue:s.spacing.fieldRight,cssUnit:s.spacing.fieldRightUnit},defaultValue:{cssValue:j.fieldRight,cssUnit:j.fieldRightUnit},updateSettings:i=>{r.debug(i)}})]}),e.jsx(F,{sx:{marginTop:"20px"},children:"Spacing within data entry fields"})]}),e.jsx(K,{single:!1})]})]}),bt=({appId:s,formSettings:n})=>{var c;const i=_(),t=L(s),l=te(s);return!((c=l==null?void 0:l.privs)!=null&&c.update)||l.primary_key.length===0?null:e.jsxs(B,{defaultExpanded:!1,disableGutters:!0,children:[e.jsx(W,{expandIcon:e.jsx(N,{}),children:"Null value handling"}),e.jsxs(z,{sx:{display:"grid"},children:[e.jsx(I,{control:e.jsx(Re,{checked:n.preserveSpacesOnUpdate,onChange:(d,p)=>{i(Xe({appId:s,preserveSpaces:p})),t(!0),d.stopPropagation()}}),label:"Preserve empty strings on update",labelPlacement:"end"}),e.jsx(F,{children:"Enable to preserve empty strings for mandatory columns. Works only if the actual column value contains an empty spaces. Does not allow strings to be emptied."}),e.jsx(F,{children:"This feature is enabled by default on WordPress tables."}),e.jsx(F,{sx:{fontWeight:"bold"},children:"Do NOT change the default unless you really need to!"})]})]})},Ct=({appId:s,app:n,relationship:i,metaData:t})=>{r.debug(s,n,i,t);const l=_(),c=L(s),[d,p]=C.useState(i.joins.split(",").map(o=>{const m=o.split("=");return{masterColumn:m[0],detailColumn:m[1]??""}}));r.debug("joins",d),C.useEffect(()=>{const o={...i};o.joins=d.map(m=>m.masterColumn+"="+m.detailColumn).join(","),l(Q({appId:s,relationship:o})),c(!0)},[d]);const T=t.app.container[0].cnt_tbl,a=t.app.container[0].cnt_cls===void 0||t.app.container[0].cnt_cls===null||t.app.container[0].cnt_cls===""?{}:JSON.parse(t.app.container[0].cnt_cls);return e.jsxs(f,{children:[...d.map((o,m)=>e.jsx(f,{sx:{display:"grid",marginTop:"10px"},children:e.jsxs(f,{sx:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) 20px minmax(0, 1fr) auto",alignItems:"center"},children:[e.jsxs(w,{children:[e.jsx(xe,{variant:"outlined",children:"master"}),e.jsxs(ge,{label:"master",value:o.masterColumn,onChange:h=>{const S=[...d];S[m].masterColumn=h.target.value,p(S),c(!0)},children:[...a.map(h=>h.isSelected?e.jsxs(M,{value:h.columnName,children:[T,".",h.columnName]}):null)]})]}),e.jsx(f,{sx:{textAlign:"center"},children:"="}),e.jsxs(w,{children:[e.jsx(xe,{variant:"outlined",children:"detail"}),e.jsxs(ge,{label:"detail",value:o.detailColumn,onChange:h=>{const S=[...d];S[m].detailColumn=h.target.value,p(S),c(!0)},children:[...n.appColumns.map(h=>h.isSelected?e.jsxs(M,{value:h.columnName,children:[n.appTable,".",h.columnName]}):null)]})]}),e.jsx(f,{children:m===0?e.jsx(Ce,{title:"Add condition",children:e.jsx(Y,{color:"primary",onClick:()=>{const h=[...d];h.push({masterColumn:"",detailColumn:""}),p(h),c(!0)},children:e.jsx(Ws,{})})}):e.jsx(Ce,{title:"Add condition",children:e.jsx(Y,{color:"primary",onClick:()=>{const h=[...d];h.splice(m,1),p(h),c(!0)},children:e.jsx(zs,{})})})})]})})),e.jsx(f,{sx:{marginTop:"20px"},children:e.jsxs(w,{fullWidth:!0,children:[e.jsx(A,{fullWidth:!0,label:"Optional conditions",multiline:!0,minRows:1,maxRows:10,value:i.sql,placeholder:"Use this field to add additional conditions to show specific details only or leave blank",onChange:o=>{const m={...i};m.sql=o.target.value,l(Q({appId:s,relationship:m})),c(!0)}}),e.jsx(Zs,{})]})}),i.cardinality===se.ONE_TO_ONE&&e.jsx(f,{sx:{marginTop:"20px"},children:e.jsx(w,{fullWidth:!0,children:e.jsx(F,{children:"A join for a 1:1 relationship must return exactly one record. An error is shown when a detail query returns more than 1 record."})})})]})},yt=({appId:s,metaData:n,isUpdating:i,initialRelationships:t,initialTitle:l,enableWizard:c})=>{const d=_(),p=lt(s),T=L(s),a=G(g=>Ke(g));r.debug("app",a);const o=G(g=>Ze(g));r.debug("relationship",o),C.useEffect(()=>{const g={...o};g.title=a.appTitle??"",g.dbs=a.appDatabase??"",g.tbl=a.appTable??"",g.cls=a.appColumns,d(Q({appId:s,relationship:g}))},[a.appDatabase,a.appTable,a.appColumns,a.appTitle]);const[m,h]=C.useState(""),S=["Relationship info","Select data source","Define join condition"],[P,u]=C.useState(0),y=g=>{switch(r.debug(g),g){case 0:if(a.appTitle===""||a.appTitle===null||l!==a.appTitle&&t.filter(x=>x.title===a.appTitle).length>0)return h("title"),!1;h("");break;case 1:if(a.appDatabase===""||a.appDatabase===null||a.appTable===""||a.appTable===null)return!1;break}return!0},E=g=>(r.debug(g),e.jsxs(f,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",justifyContent:"space-between",alignItems:"center",gap:"5px"},children:[g===0?e.jsx(f,{}):e.jsx(J,{variant:"contained",startIcon:e.jsx(xs,{}),onClick:()=>{u(g-1)},children:"Previous"}),g===2?e.jsx(J,{variant:"contained",startIcon:e.jsx(gs,{}),onClick:()=>{u(g+1)},children:"Finish"}):e.jsx(J,{variant:"contained",endIcon:e.jsx(ke,{}),onClick:()=>{y(g)&&u(g+1)},children:"Next"})]}));return e.jsxs(e.Fragment,{children:[P<=S.length&&e.jsx(f,{sx:{textAlign:"right"},children:e.jsx(J,{variant:"outlined",startIcon:e.jsx(Ue,{}),onClick:()=>{c(!1),T(!1)},children:"Cancel"})}),e.jsx(tt,{activeStep:P,orientation:"vertical",sx:{marginBottom:0},children:S.map((g,x)=>e.jsxs(it,{children:[e.jsx(nt,{children:g}),e.jsx(As,{children:e.jsxs(f,{sx:{display:"grid",gap:"20px",marginTop:"20px"},children:[x===0&&e.jsxs(e.Fragment,{children:[e.jsxs(w,{children:[e.jsxs($s,{fullWidth:!0,color:"primary",exclusive:!0,value:o.cardinality,onChange:(X,V)=>{const Z={...o};Z.cardinality=V,d(Q({appId:s,relationship:Z})),T(!0)},children:[e.jsx(de,{value:se.ONE_TO_ONE,children:"1:1"}),e.jsx(de,{value:se.ONE_TO_MANY,children:"1:m"}),e.jsx(de,{value:se.MANY_TO_MANY,disabled:!0,children:"m:m"})]}),e.jsx(F,{children:"Cardinality (m:m coming soon...)"})]}),e.jsx(A,{type:"text",label:"Title",error:m==="title",value:a.appTitle,fullWidth:!0,required:!0,helperText:"Container title (must be unique witin this form)",autoComplete:"off",onChange:X=>{d($e({appTitle:X.target.value}));const V={...o};V.title=X.target.value,d(Q({appId:s,relationship:V})),T(!0)}}),E(x)]}),x===1&&e.jsxs(e.Fragment,{children:[e.jsx(Ds,{}),e.jsx(Qs,{}),e.jsx(Is,{app:a}),E(x)]}),x===2&&e.jsxs(e.Fragment,{children:[e.jsx(Ct,{appId:s,app:a,metaData:n,relationship:o}),E(x)]})]})})]},g))}),P===S.length&&e.jsxs(f,{sx:{marginTop:"20px",display:"grid",gap:"20px"},children:[e.jsx(f,{children:"Relationship wizard successfully completed. Click button below to activate."}),e.jsx(J,{fullWidth:!0,variant:"contained",onClick:()=>{const g={app_id:n.app.container[0].app_id,app_title:o.title,app_dbs:o.dbs,app_tbl:o.tbl,app_cls:o.cls,app_relation:JSON.stringify({cnt_id_master:n.app.container[0].cnt_id,cardinality:o.cardinality,join_condition:o.joins,sql:o.sql})};i?(g.app_cnt=a.appCntId,st(g,x=>{r.debug(x),(x==null?void 0:x.code)==="ok"&&(x==null?void 0:x.message)===""?(c(!1),U("Relationship updated",{variant:"success"}),p(n,()=>{U(H.contactSupport,{variant:"error"})}),T(!1)):U(H.contactSupport,{variant:"error"})},x=>{r.error(x),U(H.contactSupport,{variant:"error"})},!1)):et(g,x=>{r.debug(x),(x==null?void 0:x.code)==="ok"&&(x==null?void 0:x.message)===""?(c(!1),U("Relationship created",{variant:"success"}),p(n,()=>{U(H.contactSupport,{variant:"error"})}),T(!1)):U(H.contactSupport,{variant:"error"})},x=>{r.error(x),U(H.contactSupport,{variant:"error"})},!1)},children:i?"Update relationship":"Create relationship"})]})]})},St=({appId:s})=>{var u;r.debug(s);const n=_();hs();const i=at(s),[t,l]=C.useState(!1);r.debug("wizardOn",t);const[c,d]=C.useState(!1);r.debug("wizardIsUpdating",c);const[p,T]=C.useState("");r.debug("wizardTitle",p);const a=te(s);r.debug(a);const o=G(y=>we(y,s));r.debug("details",o);const[m,h]=C.useState([]);r.debug(m),C.useEffect(()=>{var E,g,x,X,V;const y=[];if(o!==void 0&&o.length>0&&((E=a==null?void 0:a.app)==null?void 0:E.container)!==void 0&&Array.isArray((g=a==null?void 0:a.app)==null?void 0:g.container)){const Z=a.app.container[0].cnt_id,b=a.app.container[0].cnt_tbl;for(let v=0;v<o.length;v++)if(((x=o[v].container)==null?void 0:x.cnt_relation)!==void 0&&((X=o[v].container)==null?void 0:X.cnt_relation)!==null&&((V=o[v].container)==null?void 0:V.cnt_relation)!==""){const je=JSON.parse(o[v].container.cnt_relation);if(je.cnt_id_master===Z){const Ae=o[v].appId;y.push({appId:Ae,cntId:o[v].container.cnt_id,title:o[v].container.cnt_title,dbs:o[v].container.cnt_dbs,tbl:o[v].container.cnt_tbl,cls:o[v].container.cnt_cls===void 0||o[v].container.cnt_cls===null||o[v].container.cnt_cls===""?{}:JSON.parse(o[v].container.cnt_cls),relation:je,parentTbl:b})}}}h(y)},[s,(u=a==null?void 0:a.app)==null?void 0:u.container,o]),C.useState(""),C.useState(-1);const[S,P]=C.useState(!1);return C.useState(""),e.jsxs(e.Fragment,{children:[e.jsxs(B,{defaultExpanded:!1,disableGutters:!0,children:[e.jsx(W,{expandIcon:e.jsx(N,{}),children:"Relationships"}),e.jsxs(z,{children:[!1,e.jsx(f,{children:t?e.jsx(e.Fragment,{children:!c&&e.jsx(yt,{appId:s,metaData:a,isUpdating:c,enableWizard:l,initialRelationships:m,initialTitle:""})}):e.jsx(J,{variant:"contained",fullWidth:!0,disabled:!0,startIcon:e.jsx(ms,{}),endIcon:e.jsx(ke,{}),onClick:()=>{},children:"Start relationship wizard"})}),e.jsx(e.Fragment,{children:m.length>0&&e.jsx(f,{sx:{marginTop:"30px"},children:e.jsxs(w,{fullWidth:!0,children:[e.jsx(xe,{variant:"outlined",children:"Display type"}),e.jsxs(ge,{value:i,label:"Display type",onChange:y=>{n(De({appId:s,displayType:y.target.value}))},children:[e.jsx(M,{value:re.ACOORDION,children:"Accordion"}),e.jsx(M,{value:re.TAB,children:"Tabs"}),e.jsx(M,{value:re.TITLE,children:"Titles"})]}),e.jsx(F,{children:"Select how details should be displayed"})]})})}),e.jsx(K,{})]})]}),S&&e.jsx(me,{title:"Delete Relationship?",message:"Are you sure you want to delete this relationship? This action cannot be undone!",open:S,setOpen:P,onConfirm:()=>{}})]})},Tt=({appId:s})=>{r.debug(s),_(),L(s);const n=G(t=>Fe(t,s));r.debug("formSettings",n);const i=t=>{r.debug(t)};return e.jsxs(e.Fragment,{children:[e.jsx(St,{appId:s}),e.jsx(ht,{appId:s,formSettings:n}),e.jsx(mt,{appId:s,formSettings:n,updateSettings:i}),e.jsx(jt,{formSettings:n,updateSettings:i}),e.jsx(ft,{formSettings:n,updateSettings:i}),e.jsx(bt,{appId:s,formSettings:n})]})},li=({appId:s})=>{var V,Z;r.debug(s);const n=_(),[i,t]=C.useState(pe(D.getState(),s));r.debug(i);const[l,c]=C.useState(Qe(D.getState(),s));r.debug(l);const d=()=>is(D.getState(),s),p=b=>{n(_e({appId:s,isUpdated:b}))},[T,a]=C.useState(!1),o=((V=ye)==null?void 0:V.palette.mode)===Ie.LIGHT?(Z=ye)==null?void 0:Z.palette.primary.main:"",m=b=>{n(es({anchor:b}))},h=()=>{n(ss({appId:s,formState:i}))},S=()=>{n(ts({})),p(!1)},P=()=>{d()?a(!0):(h(),S())},u=()=>{Ns(s,Xs.GLOBAL,b=>{if(r.debug(b),b!=null&&b.code&&(b==null?void 0:b.message)!==void 0)switch(b.code){case"ok":t(pe(D.getState(),s)),U(b.message,{variant:"success"});break;case"info":U(b.message,{variant:"info"});break;default:r.error(b),U(b.message??H.contactSupport,{variant:"error"})}else r.error(b),U(H.contactSupport,{variant:"error"})},b=>{r.error("error",b),U(b??H.contactSupport,{variant:"error"})}),p(!1)},y=()=>{d()?(u(),setTimeout(()=>{S()},1e3)):S()},[E,g]=C.useState("1"),x=(b,v)=>{g(v)},X=G(b=>Me(b,s));return e.jsx(e.Fragment,{children:X&&e.jsxs(e.Fragment,{children:[e.jsxs(Ls,{closeDrawer:P,children:[e.jsx(js,{position:"static",sx:{borderRadius:0},children:e.jsxs(fs,{className:"pp-setting-toolbar",sx:{borderRadius:0},children:[e.jsx(Ks,{variant:"h5",noWrap:!0,component:"div",className:"unselectable",sx:{flexGrow:1,display:{xs:"none",sm:"block"},paddingLeft:"6px"},children:"Form Builder"}),e.jsx($,{title:"Dock to left",position:"bottom",children:e.jsx(Y,{onClick:()=>{m(fe.LEFT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(Es,{})})}),e.jsx($,{title:"Dock to right",position:"bottom",children:e.jsx(Y,{onClick:()=>{m(fe.RIGHT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(Vs,{})})}),e.jsx($,{title:"Close",position:"bottom",children:e.jsx(Y,{onClick:P,size:"large",color:"inherit",sx:{fontSize:"1.4em"},children:e.jsx(Ue,{})})})]})}),e.jsx(Te,{className:"pp-settings-container",children:e.jsx(ve,{sx:{padding:0,margin:0},children:e.jsxs(Os,{value:E,children:[e.jsxs(Gs,{variant:"fullWidth",textColor:"primary",onChange:x,sx:{width:"100%",height:"80px",padding:0,margin:0,backgroundColor:"rgb(242, 242, 242)"},children:[e.jsx(ce,{label:"Form",value:"1",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}}),e.jsx(ce,{label:"Columns",value:"2",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}}),e.jsx(ce,{label:"Theme",value:"3",sx:{fontWeight:"bold",fontSize:"110%",height:"80px"}})]}),e.jsxs(f,{sx:{margin:0,padding:0,overflowY:"auto",height:"calc(100vh - 250px)","& > div.MuiTabPanel-root":{padding:0}},children:[e.jsx(ae,{value:"1",children:e.jsx(Tt,{appId:s})}),e.jsx(ae,{value:"2",children:e.jsx(gt,{appId:s})}),e.jsx(ae,{value:"3",children:e.jsx(rt,{appId:s,setIsUpdated:p})})]})]})})}),e.jsx(Te,{className:"pp-setting-footer",sx:{borderRadius:0,backgroundColor:o},children:e.jsxs(ve,{className:"pp-setting-footer-buttons",sx:{borderRadius:0},children:[e.jsx(J,{variant:"outlined",className:"footer_action_button_apply",onClick:u,children:"Apply"}),e.jsx(J,{variant:"outlined",className:"footer_action_button",onClick:y,children:"OK"}),e.jsx(J,{variant:"outlined",className:"footer_action_button",onClick:P,children:"Cancel"})]})})]}),e.jsx(me,{title:"Close Form Builder?",message:"All uncommitted changes will be lost!",open:T,setOpen:a,onConfirm:()=>{h(),S()},onKeep:()=>{S()}})]})})};export{li as default};
