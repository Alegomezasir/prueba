import{l as t,r as N,j as e,F as P,cK as W}from"./main-1.0.4.js";import{u as C,U as I}from"./main-1.0.4-3f927327.js";import{a as J,b as M,c as E,d as R,e as V}from"./index.esm-1.0.4-1e92c0c7.js";import{F as B}from"./TextField-1.0.4-6b1bbbfd.js";import{B as k}from"./CardContent-1.0.4-55ef4296.js";import"./iconBase-1.0.4-684ba590.js";import"./Close-1.0.4-ca2bff70.js";const D="Upload or select %s from your WordPress media library",H=({appId:d,columnName:o,columnValue:f,columnMetaData:x,onColumnChange:h,columnMedia:u,mediaType:p})=>{t.debug(d,o,f,x,u,p);const S=N.useRef(null),m=C(),v=s=>{if(t.debug(s),s!=null&&s.id&&(s!=null&&s.url)&&(s!=null&&s.mime)&&(s!=null&&s.title))return{value:s.id,media:{url:s.url,mime_type:s.mime,title:s.title}}},_=()=>{t.debug("update media");const s=I(x.data_type)!=="number";t.debug(s);let r="media",n="";switch(p){case"WP-Image":r="images(s)",n="image";break;case"WP-Audio":r="audio",n="audio";break;case"WP-Video":r="video(s)",n="video";break}t.debug(r,n);const a=window.wp.media({title:D.replace("%s",r),button:{text:"Select"},library:{type:n},multiple:s,render:!1});t.debug(a),a.on("select",function(){const l=[];if(s){const i=a.state().get("selection").toJSON();t.debug(i),i.map(y=>{t.debug(y);const F=v(y);F&&l.push(F)})}else{const i=v(a.state().get("selection").first().toJSON());i&&l.push(i)}t.debug(l);const c=[],g=[];for(let i=0;i<l.length;i++)c.push(l[i].value),g.push(JSON.stringify(l[i].media));t.debug(c,g),h(o,c.toString()),m(W({appId:d,columnName:o,columnValue:g}))}),a.open()},w=()=>{t.debug("delete media"),h(o,null),m(W({appId:d,columnName:o,columnValue:[]}))},A=s=>{switch(p){case"WP-Image":return e.jsx("img",{src:s.url,title:s.title,alt:s.title});case"WP-Attachment":{const r=s.mime_type.split("/");return e.jsxs("a",{href:s.url,title:s.title,target:"_blank",className:"pp-hyperlink",children:[e.jsxs("div",{children:[r[0]==="image"&&e.jsx(J,{}),r[0]==="audio"&&e.jsx(M,{}),r[0]==="video"&&e.jsx(E,{}),r[0]==="application"?r[1]==="pdf"?e.jsx(R,{}):e.jsx(V,{}):e.jsx(e.Fragment,{})]}),e.jsx("div",{className:"link-label",children:s.title})]})}case"WP-Audio":return e.jsx("audio",{controls:!0,children:e.jsx("source",{src:s.url,type:s.mime_type})});case"WP-Video":return e.jsx("video",{controls:!0,children:e.jsx("source",{src:s.url,type:s.mime_type})})}};return e.jsxs("div",{className:`media ${p}`,children:[e.jsxs(B,{children:[u==null?void 0:u.map(s=>{try{const r=JSON.parse(s);return r!=null&&r.url?e.jsx("div",{ref:S,className:"content",children:A(r)},r.url):null}catch(r){return t.error("Invalid media properties",r),e.jsx("span",{children:"Error reading media"})}}),e.jsx("input",{type:"hidden",value:f})]}),e.jsxs("div",{className:"actions",children:[e.jsx(k,{variant:"outlined",onClick:_,disabled:!P.appPlugin,children:"Select"}),e.jsx(k,{variant:"outlined",onClick:w,disabled:!P.appPlugin,children:"Delete"})]})]})};export{H as default};
